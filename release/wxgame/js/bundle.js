!function(){"use strict";class e extends Laya.Script{constructor(){super()}onEnable(){this.owner.width=Laya.stage.width,this.owner.height=Laya.stage.height}onDisable(){}}class t extends Laya.Script{constructor(){super()}onEnable(){this.InitArr(),this.tipsContent=[],this.targets=[],this.targetY=300}InitArr(e){Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1},Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)}}add(e){this.tipsContent.push(e),this.play()}createTarget(e,t){let i=new Laya.Image;i.name="parent",i.anchorX=.5,i.anchorY=.5;let a=new Laya.Sprite;a.name="child",a.size(770,110),a.scale(0,0),a.y=this.targetY,a.loadImage("res/img/common/tip.png",Laya.Handler.create(this,()=>{a.pivot(a.width/2,a.height/2),a.x=e.width/2}));let s=new Laya.Label;return s.size(770,110),s.align="center",s.valign="middle",s.text=t,s.color="#FFFFFF",s.font="Impact",s.fontSize=40,a.addChild(s),i.addChild(a),e.addChild(i),i}play(){this.tipsContent.length>0&&this.setTween()}setTween(){let e=this.tipsContent.shift(),t=this.createTarget(this.owner,e);this.setScale(t.getChildByName("child"),1,1,300),this.UpdateTargets(),this.targets.unshift(t)}UpdateTargets(){let e=0,t=null;this.targets.forEach((i,a)=>{let s=i.getChildByName("child"),o=null!=t?t.getChildByName("child"):null,n=new Laya.Point(s.x,s.y),r=i.localToGlobal(n),h=null!=o?new Laya.Point(o.x,o.y-s.height):new Laya.Point(0,this.targetY-s.height),l=null==o?i.localToGlobal(h):t.localToGlobal(h);r.y>l.y&&(e=r.y-l.y,i.y-=e),t=i})}setScale(e,t,i,a){Laya.Tween.to(e,{scaleX:t,scaleY:t},a,null,Laya.Handler.create(this,this.setMove,[e,0,1e3]))}setMove(e,t,i){this.play(),Laya.Tween.to(e,{y:t},i,null,Laya.Handler.create(this,this.tweenEnd,[e]))}UpdateMove(e,t,i){Laya.Tween.to(e,{y:t},i)}tweenEnd(e){this.owner.removeChild(e.parent),this.targets.remove(e.parent)}removeTarget(){}onUpdate(){}}class i{constructor(){i.instance=this,this.websoketApi="132.232.34.32:8082",this.requestApi="http://132.232.34.32:8081",this.phoneNews={statusHeight:0,deviceNews:""},this.wxGame=!1,console.log(this.wxGame),this.userInfo=null,this.sign={signOut:1,register:2,changePwd:3,shop:4},this.serviceUrl="",this.pages={page1:"NoticePage",page2:"CreateGamePage",page3:"HallPage",page4:"DataPage",page5:"MePage",page6:"login"},this.gameView={desk_bg1:"res/img/gameView/desk_bg1.png",desk_bg2:"res/img/gameView/desk_bg2.png"},this.gamePoker=[0,1,2,4,5,6,8,10,15,16,17,18,19,20,21,22,28,29,30,31,32,33,34,35,39,41,43,44,45,47,49,53,-1],this.loadScene=["cheXuanGame_8.scene","playerNewsSet.scene","register.scene","shishizhanji.scene","paijuhuigu.scene","paijutishi.scene","paijutishi.scene","tabPage.scene","shoppingMall.scene","aboutOur.scene","gameSet.scene","service.scene"],this.allowGameHallSetInterval=!1,this.allowRequesList=!0,this.allowHideLoad=!1,this.defaultImg={one:"res/img/common/defaultHead.png"},this.animations={qiao:"qiao",win:"win",expression:"expression"},this.loadingType={one:"Loading",two:"Loading2",three:"Loading3",four:"Loading4"},this.chatVoice=[{id:0,voice:"res/sounds/Man_Chat_0.wav",text:"大家好,很高兴见到各位!"},{id:1,voice:"res/sounds/Man_Chat_1.wav",text:"和您合作真是太愉快了哈!"},{id:2,voice:"res/sounds/Man_Chat_2.wav",text:"快点呀,都等得我花儿都谢了!"},{id:3,voice:"res/sounds/Man_Chat_3.wav",text:"您的牌打得也太好了呀!"},{id:4,voice:"res/sounds/Man_Chat_4.wav",text:"不要吵了,不要吵了,吵啥嘛吵，专心玩游戏吧!"},{id:5,voice:"res/sounds/Man_Chat_5.wav",text:"怎么又断线了，网络怎么这么差呀!"},{id:6,voice:"res/sounds/Man_Chat_6.wav",text:"各位，真是不好意思呀，我得离开一会儿!"},{id:7,voice:"res/sounds/Man_Chat_7.wav",text:"不要走,决战到天亮呀!"},{id:8,voice:"res/sounds/Man_Chat_8.wav",text:"你是GG，还是MM?"},{id:9,voice:"res/sounds/Man_Chat_9.wav",text:"咱交个朋友吧,能告诉我您咋联系的吗!"},{id:10,voice:"res/sounds/Man_Chat_10.wav",text:"再见啦,俺会想念大家的!"}],this.expressionChat=[{id:0,icon:"res/img/Expression/0_0.png"},{id:1,icon:"res/img/Expression/1_0.png"},{id:2,icon:"res/img/Expression/2_0.png"},{id:3,icon:"res/img/Expression/3_0.png"},{id:4,icon:"res/img/Expression/4_0.png"},{id:5,icon:"res/img/Expression/5_0.png"},{id:6,icon:"res/img/Expression/6_0.png"},{id:7,icon:"res/img/Expression/7_0.png"},{id:8,icon:"res/img/Expression/8_0.png"},{id:9,icon:"res/img/Expression/9_0.png"},{id:10,icon:"res/img/Expression/10_0.png"},{id:11,icon:"res/img/Expression/11_0.png"},{id:12,icon:"res/img/Expression/12_0.png"},{id:13,icon:"res/img/Expression/13_0.png"},{id:14,icon:"res/img/Expression/14_0.png"}],this._speed={page:120},this.loadSceneResourcesArr=[],this.openSceneViewArr=[],this.loadAniArr1=[],this.loadAniArr2=[],this.loadShowArr=[],this.loadShowArr2=[],this.debug=!1,this.errList=[],this.tipArr1=[],this.tipArr2=[],this.diaLogArr1=[],this.diaLogArr2=[],this.chatVoiceOpenState=!localStorage.getItem("chatVoice")||1==localStorage.getItem("chatVoice")}$LOG(...e){this.debug&&console.log(...e)}$ERROR(...e){this.debug&&console.error(...e)}createTipBox(){let e=new Laya.Image;e.zOrder=40,e.name="tipBox",e.height=300,e.left=0,e.right=0,e.pivot(e.width/2,e.height/2),e.pos((Laya.stage.width-e.width)/2,(Laya.stage.height-e.height)/2),Laya.stage.addChild(e),e.addComponent(t),this.tipArr1=["tipBox"],this.tipArr2.forEach(i=>{e.getComponent(t).add(i.msg),this.tipArr2=[]})}showTip(e){this.tipArr1.forEach(i=>{let a=Laya.stage.getChildByName(i);if(a){a.getComponent(t).add(e)}}),0==this.tipArr1.length&&(this.tipArr2=[{msg:e}])}getStatusHeight(e){window.plus?(this.plusReady(),this.getDeviceInfo()):(document.addEventListener("plusready",this.plusReady,!1),document.addEventListener("getDeviceInfo",this.getDeviceInfo,!1))}plusReady(){var e=plus.navigator.getStatusbarHeight();this.phoneNews.statusHeight=e*plus.screen.scale}getDeviceInfo(){this.phoneNews.deviceNews=plus.os.name}setNodeTop(e){"Android"==this.phoneNews.deviceNews&&e.forEach(e=>{e.top=e.top+this.phoneNews.statusHeight,console.log(e.top)})}getTimeChuo(){return Math.round(new Date/1e3)}GetUrlString(e){let t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):null}createDiaLog(){let e=Laya.stage.getChildByName("dialogMask");e&&e.removeSelf();let t=new Laya.Sprite;this.diaLogMask=t,t.visible=!1,t.zOrder=4,t.pos(0,0),t.size(Laya.stage.width,Laya.stage.height),this.diaLog=new Laya.Dialog,this.diaLog.pos((Laya.stage.width-1132)/2,(Laya.stage.height-764)/2),this.diaLog.size(1132,764),this.diaLog.zOrder=5;let i=new Laya.Image;i.pos(0,0),i.loadImage("res/img/diglog/bg.png");let a=new Laya.Text;a.fontSize=60,a.color="#935F13",a.size(1132,180),a.align="center",a.valign="middle",a.y=250,a.text="";let s=new Laya.Image;s.size(609,163),s.loadImage("res/img/diglog/btn_one.png",Laya.Handler.create(this,()=>{s.pos((1132-s.width)/2,764-s.height-60)}));let o=new Laya.Image,n=new Laya.Image;o.size(460,163),n.size(460,163),o.loadImage("res/img/diglog/btn_cancel.png",Laya.Handler.create(this,()=>{o.pos(72,764-o.height-60)})),n.loadImage("res/img/diglog/btn_comfirm.png",Laya.Handler.create(this,()=>{n.pos(600,764-n.height-60)})),i.addChild(a),i.addChild(s),i.addChild(o),i.addChild(n),this.diaLog.addChild(i),t.addChild(this.diaLog),Laya.stage.addChild(t),this.diaLogArr1=[{btn1:s,btn2:o,btn3:n,msg:a}],this.diaLogCommon()}closeDiaLog(){this.diaLog.close(),this.diaLogMask.visible=!1;let e=this.diaLogArr1[0];e.btn1.off(Laya.Event.CLICK),e.btn2.off(Laya.Event.CLICK),e.btn3.off(Laya.Event.CLICK)}diaLogCommon(){let e=this.diaLogArr1[0];this.diaLogArr2.forEach(t=>{e.btn1.visible=1==t.type,e.btn2.visible=2==t.type,e.btn3.visible=2==t.type,e.msg.text=t.msg,e.msg.color=t.color,this.diaLogMask.visible=!0,this.diaLog.show(),e.btn1.on(Laya.Event.CLICK,this,()=>{t.comfirmFn&&t.comfirmFn("点击了确定按钮"),this.closeDiaLog()}),e.btn2.on(Laya.Event.CLICK,this,()=>{t.cancelFn&&t.cancelFn("点击了取消按钮"),this.closeDiaLog()}),e.btn3.on(Laya.Event.CLICK,this,()=>{t.comfirmFn&&t.comfirmFn("点击了确定按钮"),this.closeDiaLog()}),this.diaLogMask.on(Laya.Event.CLICK,this,()=>{t.cancelFn&&t.cancelFn("点击了取消按钮"),this.closeDiaLog()})}),this.diaLogArr2=[]}showDiaLog(e="",t,i,a,s){let o=e||"",n=t||1,r=s||"#935F13";this.diaLogArr1.length>0?this.diaLogArr1.forEach(e=>{e.btn1.visible=1==n,e.btn2.visible=2==n,e.btn3.visible=2==n,e.msg.text=o,e.msg.color=r,this.diaLogMask.visible=!0,this.diaLog.show(),e.btn1.on(Laya.Event.CLICK,this,()=>{i&&i("点击了确定按钮"),this.closeDiaLog()}),e.btn2.on(Laya.Event.CLICK,this,()=>{a&&a("点击了取消按钮"),this.closeDiaLog()}),e.btn3.on(Laya.Event.CLICK,this,()=>{i&&i("点击了确定按钮"),this.closeDiaLog()}),this.diaLogMask.on(Laya.Event.CLICK,this,()=>{a&&a("点击了取消按钮"),this.closeDiaLog()})}):this.diaLogArr2=[{msg:o,type:n,comfirmFn:i,cancelFn:a,color:r}]}setText(e,t,i){return e.fontSize=t,e.color=i,e}createLoading(e=this.loadingType.one){Laya.loader.load("res/atlas/images/common.atlas",Laya.Handler.create(this,function(){let t=new Laya.Image;t.visible=!1,t.left=0,t.top=0,t.bottom=0,t.right=0,t.zOrder=10,t.name="loadingMask-"+e,t.on(Laya.Event.CLICK,this,()=>{});let i=new Laya.Sprite,a=new Laya.Label;if(e==this.loadingType.three){a.name="loadingText",a.width=220,a.centerX=0,a.align="center",a.zOrder=10,a.bottom=-85;let e=this.setText(a,30,"#FFFFFF");i.addChild(e)}i.name="loadingBox",i.pos(Laya.stage.width/2,Laya.stage.height/2);let s=new Laya.Animation;s.name="loadingAni",s.loadAnimation("animation/loading/"+e+".ani"),i.addChild(s),t.addChild(i),Laya.stage.addChild(t),this.loadAniArr1.push(e),this.loadAniArr2.forEach(t=>{if(t.key==e){let e=Laya.stage.getChildByName("loadingMask-"+t.type);e.visible=t.show,a.text="",t.show?(a.text=t.text,s.play()):s.stop()}})}))}showLoading(e=!0,t=this.loadingType.one,i=""){this.loadAniArr1.forEach(a=>{if(a==t){let a,s=Laya.stage.getChildByName("loadingMask-"+t),o=s.getChildByName("loadingBox"),n=o.getChildByName("loadingAni");return t==this.loadingType.three&&((a=o.getChildByName("loadingText")).text=""),!s.visible&&e?(t==this.loadingType.three&&(a.text=i),n.play()):e||n.stop(),void(s.visible=e)}}),this.loadAniArr2=[{key:t,show:e,type:t,text:i}]}hideAllLoading(){this.showLoading(!1,this.loadingType.one),this.showLoading(!1,this.loadingType.two),this.showLoading(!1,this.loadingType.three)}$LoadImage(e,t="",i=this.defaultImg.one,a="loadImage"){-1!=t.indexOf(".png")||-1!=t.indexOf(".jpg")||-1!=t.indexOf(".jpeg")?Laya.loader.load(t,Laya.Handler.create(this,s=>{s?"loadImage"==a?e.loadImage(t):"skin"==a&&(e.skin=t):"loadImage"==a?e.loadImage(i):"skin"==a&&(e.skin=i)})):"loadImage"==a?e.loadImage(i):"skin"==a&&(e.skin=i)}$slider(e,t,i,a){t.x=0,t.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown,[e,t,i,a])}onMouseDown(e,t,i,a){Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove,[e,t,i,a]),t.x=t.x,Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.onMouseUp)}onMouseMove(e,t,i,a){t.x=Math.max(Math.min(e.mouseX,e.width),0),a&&a.call(i,t.x)}onMouseUp(){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onMouseUp),Laya.stage.off(Laya.Event.MOUSE_OUT,this,this.onMouseUp)}$switch(e,t,i,a){let s=1==t,o=e.getChildByName("switch0"),n=e.getChildByName("switch1");o.visible=!s,n.visible=!!s,e.on(Laya.Event.CLICK,this,()=>{o.visible=n.visible,n.visible=!o.visible,n.visible&&a?a.call(i,!0):o.visible&&a&&a.call(i,!1)})}beforeLoadScene(e,t){this.beforeLoadThat=e,this.beforeLoadCallback=t,Laya.loader.load([this.gameView.desk_bg1,this.gameView.desk_bg2]),this.gamePoker.forEach(e=>{Laya.loader.load("res/img/poker/"+e+".png")}),this.loadScene.forEach(e=>{Laya.Scene.load(e,Laya.Handler.create(this,this.openView))})}openView(e){this.beforeLoadCallback.call(this.beforeLoadThat,e),this.$LOG("预加载的资源：",e),this.loadSceneResourcesArr.push(e.url),this.openSceneViewArr.forEach((t,i)=>{if(-1!=t.url.indexOf(e.url))return Laya.Scene.open(e.url,t.closeOther,t.data,Laya.Handler.create(this,t.fn),()=>{console.log("Main中正在打开==================1")}),void this.openSceneViewArr.splice(i,1)})}$openScene(e,t=!0,i=null,a,s){this.loadSceneResourcesArr.forEach(s=>{-1==s.indexOf(e)||Laya.Scene.open(e,t,i,Laya.Handler.create(this,a),Laya.Handler.create(this,()=>{console.log("Main中正在打开==================2")}))}),this.openSceneViewArr=[{url:e,closeOther:t,data:i,fn:a,fn2:s}]}secondToDate(e){return(Math.floor(e/3600)<10?"0"+Math.floor(e/3600):Math.floor(e/3600))+":"+(Math.floor(e/60%60)<10?"0"+Math.floor(e/60%60):Math.floor(e/60%60))+":"+(Math.floor(e%60)<10?"0"+Math.floor(e%60):Math.floor(e%60))}getFormatTime(e){if(null!=e){let t=new Date(e),i=t.getFullYear(),a=t.getMonth()+1,s=t.getDate(),o=t.getHours(),n=t.getMinutes();return{nowY:i,month:a<10?"0"+a:a,day:s<10?"0"+s:s,hour:o<10?"0"+o:o,minutes:n<10?"0"+n:n,timeStr:i+"-"+a+"-"+s}}return null}}var a=new i;class s extends Laya.Script{constructor(){super(),this.backType=0,this.backScene="",this.backData=null,this.removeNode=null}initBack(e,t,i,a){this.backType=e||0,this.backScene=t||"",this.backData=i||null,this.removeNode=a||null}onEnable(){this.initBack(),this.bindEvent()}bindEvent(){this.owner.on(Laya.Event.CLICK,this,this.back)}back(){let e=this.owner.scene;0==this.backType?Laya.Tween.to(e,{x:Laya.stage.width},a._speed.page,null,Laya.Handler.create(this,()=>{e.removeSelf()})):1==this.backType&&Laya.Scene.open(this.backScene,!1,this.backData,Laya.Handler.create(this,t=>{Laya.Tween.to(e,{x:Laya.stage.width},a._speed.page,null,Laya.Handler.create(this,()=>{e.removeSelf()}))})),this.removeNode&&Laya.Browser.document.body.removeChild(this.removeNode)}}class o extends Laya.Script{constructor(){super()}onEnable(){if(this.owner.zOrder=20,"Android"==a.phoneNews.deviceNews){let e=this.owner.height,t=this.owner.getChildByName("titleBox");this.owner.height=e+a.phoneNews.statusHeight,t.top=t.top+a.phoneNews.statusHeight}}}var n=new class{constructor(){}specialTable(){return[{name:"丁皇",type1:1,type2:3,point1:1,point2:1},{name:"天牌",type1:1,type2:1,point1:10,point2:10},{name:"地牌",type1:1,type2:1,point1:0,point2:0},{name:"人牌",type1:1,type2:1,point1:6,point2:6},{name:"和牌",type1:1,type2:1,point1:2,point2:2},{name:"梅十",type1:2,type2:2,point1:8,point2:8},{name:"板凳",type1:2,type2:2,point1:2,point2:2},{name:"长三",type1:2,type2:2,point1:4,point2:4},{name:"虎头",type1:2,type2:2,point1:9,point2:9},{name:"苕十",type1:1,type2:1,point1:8,point2:8},{name:"猫猫",type1:1,type2:1,point1:4,point2:4},{name:"膏药",type1:1,type2:1,point1:5,point2:5},{name:"豹子",type1:2,type2:2,point1:3,point2:3},{name:"豹子",type1:2,type2:2,point1:5,point2:5},{name:"豹子",type1:2,type2:2,point1:6,point2:6},{name:"豹子",type1:2,type2:2,point1:7,point2:7},{name:"天王",type1:1,type2:2,point1:10,point2:7},{name:"地王",type1:1,type2:2,point1:0,point2:7},{name:"天杠",type1:1,type2:2,point1:10,point2:6},{name:"天杠",type1:1,type2:1,point1:10,point2:6},{name:"地杠",type1:1,type2:2,point1:0,point2:6},{name:"地杠",type1:1,type2:1,point1:0,point2:6},{name:"天关九",type1:1,type2:2,point1:10,point2:5},{name:"天关九",type1:1,type2:1,point1:10,point2:5},{name:"地关九",type1:1,type2:2,point1:0,point2:5},{name:"地关九",type1:1,type2:1,point1:0,point2:5},{name:"灯笼九",type1:1,type2:2,point1:6,point2:9},{name:"和五九",type1:1,type2:2,point1:2,point2:3},{name:"丁长九",type1:1,type2:2,point1:1,point2:4},{name:"梅十九",type1:2,type2:2,point1:8,point2:7},{name:"丁猫九",type1:1,type2:1,point1:1,point2:3},{name:"乌龙九",type1:2,type2:2,point1:9,point2:6},{name:"苕十九",type1:1,type2:2,point1:8,point2:7}]}sanHuaTable(){return[{name:"三花特牌",type1:2,type2:1,type3:2,point1:8,point2:8,point3:9},{name:"三花特牌",type1:2,type2:1,type3:3,point1:4,point2:4,point3:1}]}searchCombination(e,t){let i=parseInt(e/13),a=parseInt(t/13),s=e%13,o=t%13;i=4==i?3:0==i||3==i?1:2,a=4==a?3:1==a||2==a?2:1;let n=this.specialTable(),r="";return n.forEach(e=>{(i==e.type1&&a==e.type2&&s==e.point1&&o==e.point2||i==e.type2&&a==e.type1&&s==e.point2&&o==e.point1)&&(r=e.name)}),r}searchSanHua(e,t,i){let a=parseInt(e/13),s=parseInt(t/13),o=parseInt(i/13),n=e%13,r=t%13,h=i%13;a=4==a?3:0==a||3==a?1:2,s=4==s?3:1==s||2==s?2:1,o=4==o?3:1==o||2==o?2:1;let l=this.sanHuaTable(),d=null;return l.forEach(e=>{(a==e.type1&&s==e.type2&&o==e.type3&&n==e.point1&&r==e.point2&&h==e.point3||a==e.type1&&s==e.type3&&o==e.type2&&n==e.point1&&r==e.point3&&h==e.point2||a==e.type2&&s==e.type1&&o==e.type3&&n==e.point2&&r==e.point1&&h==e.point3||a==e.type2&&s==e.type3&&o==e.type1&&n==e.point2&&r==e.point3&&h==e.point1||a==e.type3&&o==e.type2&&s==e.type1&&n==e.point3&&h==e.point2&&r==e.point1||a==e.type3&&s==e.type2&&o==e.type1&&n==e.point3&&r==e.point2&&h==e.point1)&&(d=e.name)}),d}countPoint(e,t){let i,a,s=this.searchCombination(e,t);return i=4==parseInt(e/13)?6:e%13+2,a=4==parseInt(t/13)?6:t%13+2,""==s&&(s=(i+a)%10+"点"),s}sanHuaPoker(e,t,i){return this.searchSanHua(e,t,i)}};class r extends Laya.Script{constructor(e){super(),this.connectUrl=e,this.valid=!1,this.connecting=!1,this.socketOpen=!1,this.socketMsgQueue=[],this.debug=!1,this.intervalId=0,this.RpcId=100,this.RpcIdMap=new Map,console.log("【WebSocket】new NetClient() "+e),this.url="ws://localhost:8989",this.byte=new Laya.Byte,this.byte.endian=Laya.Byte.LITTLE_ENDIAN,this.socket=new Laya.Socket,this.socket.endian=Laya.Byte.LITTLE_ENDIAN,this.socket.on(Laya.Event.OPEN,this,this.openHandler),this.socket.on(Laya.Event.MESSAGE,this,this.receiveHandler),this.socket.on(Laya.Event.CLOSE,this,this.closeHandler),this.socket.on(Laya.Event.ERROR,this,this.errorHandler),this.onStartConnect=function(){console.log("【WebSocket】开始连接")},this.onConnectSucc=function(){console.log("【WebSocket】链接成功")},this.onMessage=function(e){console.log("【WebSocket】收到消息(请自己实现消息处理)："+e)}}openHandler(e){this.connecting=!1,this.socketOpen=!0,console.log("【WebSocket】连接已打开！"),this.onConnectSucc();for(var t=0;t<this.socketMsgQueue.length;t++)this.sendBinary(this.socketMsgQueue[t]);this.socketMsgQueue=[]}closeHandler(e){this.connecting=!1,this.socketOpen=!1,console.log("【WebSocket】已关闭！",e),this.socket.close()}errorHandler(e){this.connecting=!1,this.socketOpen=!1,console.log("【WebSocket】连接打开失败，请检查！"+e),this.socket.close()}Log(e){this.debug&&console.log(e)}reconnect(){console.log("【WebSocket】开始重连"),this.open()}getSocket(){return this.socketOpen||this.connecting||!this.valid?this.socketOpen?this.socket:null:(this.socket.close(),this.onStartConnect(),this.connecting=!0,this.socketOpen=!1,console.log("【WebSocket】开始连接 ",this.connectUrl),this.socket.connectByUrl(this.connectUrl),null)}open(){this.close(),this.valid=!0,this.getSocket(),this.intervalId=setInterval(()=>{this.sendHeart()},5e3)}sendHeart(){null!=this.getSocket()&&(this.byte.clear(),this.byte.writeInt32(0),this.socket.send(this.byte.buffer))}close(){this.valid=!1,this.socket.close(),clearInterval(this.intervalId),console.log("【WebSocket】关闭连接"+this.connectUrl)}stringSource(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}send(e){if(this.valid){this.debug&&console.log("【WebSocket】发送消息 ",e),null!=e.callback&&(e.data.RpcId=++this.RpcId,this.RpcIdMap.set(e.data.RpcId,e.callback)),this.byte.clear(),this.byte.pos=4,this.byte.writeUTFString(e.name),this.byte.writeUTFString(JSON.stringify(e.data));var t=this.byte.pos;this.byte.pos=0,this.byte.writeInt32(t),this.sendBinary(this.byte.buffer),this.byte.clear()}else console.log("【WebSocket】请先调用 open() 开启网络")}sendBinary(e){null!=this.getSocket()?this.socket.send(e):this.socketMsgQueue.push(e)}receiveHandler(e){this.byte.clear(),this.byte.writeArrayBuffer(e),this.byte.pos=0;this.byte.getInt32(),this.byte.getUint8();let t,i;(new Laya.Byte).endian=Laya.Byte.LITTLE_ENDIAN,this.byte.pos=4,t=this.byte.readUTFString();{let e=this.byte.readUTFString();i=JSON.parse(e)}if(this.debug&&console.log("收到消息: ",i),i.RpcId>100&&this.RpcIdMap.has(i.RpcId)){let e=this.RpcIdMap.get(i.RpcId);return null!=e&&e(t,i),void this.RpcIdMap.delete(i.RpcId)}this.onMessage(t,i)}}let h=[];var l=new class{constructor(){}onEnable(){}onDisable(){}req(e){(h=[]).push(e)}send(e,t){h.forEach(i=>{e==i.key&&i.callback(t)})}loadGameView(e){}};function safeAdd(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function md5cmn(e,t,i,a,s,o){return safeAdd((n=safeAdd(safeAdd(t,e),safeAdd(a,o)))<<(r=s)|n>>>32-r,i);var n,r}function md5ff(e,t,i,a,s,o,n){return md5cmn(t&i|~t&a,e,t,s,o,n)}function md5gg(e,t,i,a,s,o,n){return md5cmn(t&a|i&~a,e,t,s,o,n)}function md5hh(e,t,i,a,s,o,n){return md5cmn(t^i^a,e,t,s,o,n)}function md5ii(e,t,i,a,s,o,n){return md5cmn(i^(t|~a),e,t,s,o,n)}function binlMD5(e,t){var i,a,s,o,n;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var r=1732584193,h=-271733879,l=-1732584194,d=271733878;for(i=0;i<e.length;i+=16)a=r,s=h,o=l,n=d,r=md5ff(r,h,l,d,e[i],7,-680876936),d=md5ff(d,r,h,l,e[i+1],12,-389564586),l=md5ff(l,d,r,h,e[i+2],17,606105819),h=md5ff(h,l,d,r,e[i+3],22,-1044525330),r=md5ff(r,h,l,d,e[i+4],7,-176418897),d=md5ff(d,r,h,l,e[i+5],12,1200080426),l=md5ff(l,d,r,h,e[i+6],17,-1473231341),h=md5ff(h,l,d,r,e[i+7],22,-45705983),r=md5ff(r,h,l,d,e[i+8],7,1770035416),d=md5ff(d,r,h,l,e[i+9],12,-1958414417),l=md5ff(l,d,r,h,e[i+10],17,-42063),h=md5ff(h,l,d,r,e[i+11],22,-1990404162),r=md5ff(r,h,l,d,e[i+12],7,1804603682),d=md5ff(d,r,h,l,e[i+13],12,-40341101),l=md5ff(l,d,r,h,e[i+14],17,-1502002290),r=md5gg(r,h=md5ff(h,l,d,r,e[i+15],22,1236535329),l,d,e[i+1],5,-165796510),d=md5gg(d,r,h,l,e[i+6],9,-1069501632),l=md5gg(l,d,r,h,e[i+11],14,643717713),h=md5gg(h,l,d,r,e[i],20,-373897302),r=md5gg(r,h,l,d,e[i+5],5,-701558691),d=md5gg(d,r,h,l,e[i+10],9,38016083),l=md5gg(l,d,r,h,e[i+15],14,-660478335),h=md5gg(h,l,d,r,e[i+4],20,-405537848),r=md5gg(r,h,l,d,e[i+9],5,568446438),d=md5gg(d,r,h,l,e[i+14],9,-1019803690),l=md5gg(l,d,r,h,e[i+3],14,-187363961),h=md5gg(h,l,d,r,e[i+8],20,1163531501),r=md5gg(r,h,l,d,e[i+13],5,-1444681467),d=md5gg(d,r,h,l,e[i+2],9,-51403784),l=md5gg(l,d,r,h,e[i+7],14,1735328473),r=md5hh(r,h=md5gg(h,l,d,r,e[i+12],20,-1926607734),l,d,e[i+5],4,-378558),d=md5hh(d,r,h,l,e[i+8],11,-2022574463),l=md5hh(l,d,r,h,e[i+11],16,1839030562),h=md5hh(h,l,d,r,e[i+14],23,-35309556),r=md5hh(r,h,l,d,e[i+1],4,-1530992060),d=md5hh(d,r,h,l,e[i+4],11,1272893353),l=md5hh(l,d,r,h,e[i+7],16,-155497632),h=md5hh(h,l,d,r,e[i+10],23,-1094730640),r=md5hh(r,h,l,d,e[i+13],4,681279174),d=md5hh(d,r,h,l,e[i],11,-358537222),l=md5hh(l,d,r,h,e[i+3],16,-722521979),h=md5hh(h,l,d,r,e[i+6],23,76029189),r=md5hh(r,h,l,d,e[i+9],4,-640364487),d=md5hh(d,r,h,l,e[i+12],11,-421815835),l=md5hh(l,d,r,h,e[i+15],16,530742520),r=md5ii(r,h=md5hh(h,l,d,r,e[i+2],23,-995338651),l,d,e[i],6,-198630844),d=md5ii(d,r,h,l,e[i+7],10,1126891415),l=md5ii(l,d,r,h,e[i+14],15,-1416354905),h=md5ii(h,l,d,r,e[i+5],21,-57434055),r=md5ii(r,h,l,d,e[i+12],6,1700485571),d=md5ii(d,r,h,l,e[i+3],10,-1894986606),l=md5ii(l,d,r,h,e[i+10],15,-1051523),h=md5ii(h,l,d,r,e[i+1],21,-2054922799),r=md5ii(r,h,l,d,e[i+8],6,1873313359),d=md5ii(d,r,h,l,e[i+15],10,-30611744),l=md5ii(l,d,r,h,e[i+6],15,-1560198380),h=md5ii(h,l,d,r,e[i+13],21,1309151649),r=md5ii(r,h,l,d,e[i+4],6,-145523070),d=md5ii(d,r,h,l,e[i+11],10,-1120210379),l=md5ii(l,d,r,h,e[i+2],15,718787259),h=md5ii(h,l,d,r,e[i+9],21,-343485551),r=safeAdd(r,a),h=safeAdd(h,s),l=safeAdd(l,o),d=safeAdd(d,n);return[r,h,l,d]}function binl2rstr(e){var t,i="",a=32*e.length;for(t=0;t<a;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function rstr2binl(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var a=8*e.length;for(t=0;t<a;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function rstr2hex(e){var t,i,a="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),a+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return a}function str2rstrUTF8(e){return unescape(encodeURIComponent(e))}function rawMD5(e){return function(e){return binl2rstr(binlMD5(rstr2binl(e),8*e.length))}(str2rstrUTF8(e))}function rawHMACMD5(e,t){return function(e,t){var i,a,s=rstr2binl(e),o=[],n=[];for(o[15]=n[15]=void 0,s.length>16&&(s=binlMD5(s,8*e.length)),i=0;i<16;i+=1)o[i]=909522486^s[i],n[i]=1549556828^s[i];return a=binlMD5(o.concat(rstr2binl(t)),512+8*t.length),binl2rstr(binlMD5(n.concat(a),640))}(str2rstrUTF8(e),str2rstrUTF8(t))}var d={md5:function(e,t,i){return t?i?rawHMACMD5(t,e):rstr2hex(rawHMACMD5(t,e)):i?rawMD5(e):rstr2hex(rawMD5(e))}};var c=new class{$request(e){let t=e.that,i=new Laya.HttpRequest,s=a.requestApi+e.url,o=e.data,n="",r=e.method?e.method:"get",h=[];if("get"==r){var l=(new Date).getTime();let e="";for(var c in a.userInfo&&(e=a.userInfo.key+"&"+l),o)o.hasOwnProperty(c)&&(h.push(c),s=1==h.length?s+"?"+c+"="+o[c]:s+"&"+c+"="+o[c],e+="&"+o[c]);a.userInfo&&(s+="&t="+l,a.$LOG("md5："+e+" key:"+a.userInfo.key),s+="&sign="+d.md5(e))}else if("post"==r)for(var c in o)o.hasOwnProperty(c)&&(h.push(c),1==h.length?n=c+"="+o[c]:n+="&"+c+"="+o[c]);i.http.timeout=2e4,i.once(Laya.Event.COMPLETE,this,i=>{if(!i.status)return a.$ERROR("冲突登录:",i),void(1003!=i.code&&1004!=i.code||a.showDiaLog("登录失效，请重新登录",1,()=>{a.hideAllLoading(),Laya.Scene.open("login.scene",!0,a.sign.signOut)}));e.success.call(t,i)}),i.once(Laya.Event.ERROR,this,i=>{console.log("请求异常:",i),a.showDiaLog("网络异常"),e.fail&&e.fail.call(t,i)}),i.on(Laya.Event.PROGRESS,this,t=>{console.log(t),e.ess&&e.ess(t)}),i.send(s,n,r,"json")}};var g=new class{init(e){let t=e.getChildByName("fastChatBox");this.x=t.x,this.y=t.y,t.skin="res/img/common/"+e._fastChatBoxSeatBgImg,-1!=e._fastChatBoxSeatBgImg.indexOf("qipao_left")?t.sizeGrid="0,28,0,51":-1!=e._fastChatBoxSeatBgImg.indexOf("qipao_right")&&(t.sizeGrid="0,57,0,27"),t.x=this.x,t.y=this.y}};var m=new class{init(e){let t=e.owner;t.mang_cm_pool.zOrder=2,t.pi_cm_pool.zOrder=2,t._playerSeatXYArray=[],t._xiaZhuSeatXYArray=[],t._tipsSeatXYArray=[],t._pokerBoxSeat=[],t._showCMFaceToPlayerXY=[],t._mangDiChiFaceToPlayerXYArray=[],t._piDiChiFaceToPlayerXYArray=[],t._subPokerBoxSeat=[],t._fastChatBoxSeat=[],t._fastChatBoxSeatBgImg=[]}keepValue(e,t){let i=t.owner,a=e.owner;i.mePokerX_2=[],i.mePokerX_3=[],i.mePokerX_4=[],i.sub1=[],i.sub2=[],i.sub1Point="",i.sub2Point="",i.index=t.INDEX,i.seatId=t.INDEX,i.userId="",i.isMe=!1,i.showXiaZhuScore=!1,i.xiaZhuScore=0,a._playerSeatXYArray.push({index:e.INDEX,x:i.x,y:i.y}),a._xiaZhuSeatXYArray.push({index:e.INDEX,x:i.getChildByName("xiaZhuScore").x,y:i.getChildByName("xiaZhuScore").y}),a._tipsSeatXYArray.push({index:e.INDEX,x:i.getChildByName("tipsBox").x,y:i.getChildByName("tipsBox").y}),a._pokerBoxSeat.push({index:e.INDEX,x:i.getChildByName("show_poker_box").x,y:i.getChildByName("show_poker_box").y}),a._subPokerBoxSeat.push({x:i.getChildByName("sub_poker_box").x,y:i.getChildByName("sub_poker_box").y}),a._fastChatBoxSeat.push({x:i.getChildByName("fastChatBox").x,y:i.getChildByName("fastChatBox").y}),t.INDEX<=4?(a._fastChatBoxSeatBgImg.push("qipao_left.png"),i._fastChatBoxSeatBgImg="qipao_left.png"):(a._fastChatBoxSeatBgImg.push("qipao_right.png"),i._fastChatBoxSeatBgImg="qipao_right.png");{let e=i.getChildByName("xiaZhuScore"),t=i.getChildByName("xiaZhuScore").getChildByName("cm_show_seat"),s=i.getChildByName("create_cm_seat"),o=this.getCoordinate(s,e,t).x,n=this.getCoordinate(s,e,t).y;a._showCMFaceToPlayerXY.push({x:o,y:n}),i._showCMFaceToPlayerXY={x:o,y:n}}{let e=i.getChildByName("create_cm_seat").getChildByName("move_cm"),t=e.globalToLocal(new Laya.Point(a.mang_cm_pool.x,a.mang_cm_pool.y)),s=e.globalToLocal(new Laya.Point(a.pi_cm_pool.x,a.pi_cm_pool.y));a._mangDiChiFaceToPlayerXYArray.push({x:t.x+50,y:t.y}),a._piDiChiFaceToPlayerXYArray.push({x:s.x+100,y:s.y}),i._mangDiChiFaceToPlayerXY={x:t.x+50,y:t.y},i._piDiChiFaceToPlayerXY={x:s.x+100,y:s.y}}i._diuPokerSeatXY={x:i.getChildByName("deal_cards_seat34").x,y:i.getChildByName("deal_cards_seat34").y},g.init(i)}getCoordinate(e,t,i){let a=i.x-t.width/2,s=i.y-t.height/2;return{x:a+(t.x-e.x),y:s+(t.y-e.y)}}};var p=new class{init(e,t,i){this.delayType=e,this.GameControl=t,i&&(this.GameControl.owner.delayTimeBtn.visible=!0,this.GameControl.owner.delayTimeBtn.getChildByName("value").text=i.delayedScore,this.GameControl.owner.delayTimeBtn.on(Laya.Event.CLICK,this,this.onClickDelayTime))}offEvent(e){a.$LOG("玩家延时操作offEvent:",e),e.owner.delayTimeBtn&&(e.owner.delayTimeBtn.visible=!1,e.owner.delayTimeBtn.off(Laya.Event.CLICK,this,this.onClickDelayTime))}onClickDelayTime(e){let t=this;this.GameControl.onSend({name:"M.Games.CX.C2G_TimeDelay",data:{roomId:this.GameControl.roomId},success(e){a.$LOG("延时操作：",e),t.dealWithRes(t.GameControl,e)}})}dealWithRes(e,t){0==t.ret.type?(a.showTip(t.ret.msg),e.owner.delayTimeBtn.getChildByName("value").text=t.delayedNum==t.delayedNumMax?"MAX":t.delayedScore,this.delayType==e.delayType.action?e._playerArray.forEach(e=>{t.userId==e.owner.userId&&e.showPlayerCountDown(t)}):this.delayType==e.delayType.sub&&e.assignPokerCountDown(!0,t)):a.showTip("您已达到延时最大次数!")}};Laya.Sprite;const y=Laya.Event;class u extends Laya.Script{constructor(){super()}onEnable(){this.InitAttribute(),this.InitEvent()}InitAttribute(){this.slider=this.owner,this.sliderBg=this.slider.getChildByName("da_sliderBg"),this.sliderHeight=this.sliderBg.getChildByName("da_sliderHeight"),this.maxVal=this.sliderBg.getChildByName("da_maxNum").getChildByName("value"),this.handler=this.sliderBg.getChildByName("da_handler"),this.texNum=this.handler.getChildByName("da_texNum"),this.slider.visible=!1,this.beginPosition=this.handler.y,this.endPosition=this.handler.y-this.sliderHeight.height,a.$LOG(this.beginPosition,this.endPosition,this.sliderBg.height),this.Init()}InitEvent(){}SliderMouseDown(e,t,i,a){this.Show(e,t,i,a),Laya.stage.on(y.MOUSE_MOVE,this,this.SliderMouseMove),Laya.stage.on(y.MOUSE_UP,this,this.SliderMouseUp),Laya.stage.on(y.MOUSE_OUT,this,this.SliderMouseUp),this.SliderVal(0),this.handler.y=this.beginPosition,this.maxVal.text=t}test1(e,t){a.$LOG("进度："+e+"-"+t)}testEnd(e){a.$LOG("抬起:"+e)}Show(e,t,i,a){this.sShow=!0,this.sCalibration=0,this.sStartVal=e,this.sEndVal=t,this.sEndAction=a,this.sDragAction=i,this.sCurDragVal=0,this.slider.visible=!0}RemoveSliderEvent(){Laya.stage.off(y.MOUSE_MOVE,this,this.SliderMouseMove),Laya.stage.off(y.MOUSE_UP,this,this.SliderMouseUp),Laya.stage.off(y.MOUSE_OUT,this,this.SliderMouseUp)}SliderMouseUp(e){this.RemoveSliderEvent(),null!=this.sEndAction&&this.sEndAction(this.sCurDragVal),this.Init()}SliderMouseMove(e){let t=new Laya.Point(Laya.stage.mouseX,Laya.stage.mouseY),i=this.sliderBg.globalToLocal(t);this.handler.y=Math.min(Math.max(i.y,this.endPosition),this.beginPosition),this.SliderVal((this.beginPosition-this.handler.y)/(this.beginPosition-this.endPosition))}Init(){this.slider.visible=!1,this.sShow=!1,this.sCalibration=0,this.sStartVal=0,this.sEndVal=0,this.sCurDragVal=0}SliderVal(e){this.sShow?this.texNum.text=this.CalculationCalibration(this.sStartVal,this.sEndVal,e,this.sDragAction):RemoveSliderEvent()}CalculationCalibration(e,t,i,s){let o=[2,5,100],n=e.toString().length-1,r=Math.pow(10,n+1),h=o.length>n?o[n]:o[o.length-1]*Math.pow(10*n-o.length),l=[],d=1;l.push(0);let c=e;l.push(c);let g=c%h;g>0&&h-g+c<t&&(c=h-g+c,l.push(c),++d);let m=e+(g>0?h-g:0);for(a.$LOG(t+"-"+r+"-"+h);t>=r;){let e=parseInt((r-m)/h),t=0;for(;t<e;)c+=h,l.push(c),++t;d+=e,m=r,r*=10,o.length>++n?h=o[n]:(h*=10,a.$LOG(h))}let p=parseInt((t-m)/h),y=0;for(;y<p&&c<t;)c+=h,l.push(c),++y;d+=p-(p-y),t%h>0&&(++d,l.push(t));let u=parseInt(i*d),w=l[u];return null!=this.sDragAction&&this.sCurDragVal!=w&&this.sDragAction(l[u],u==d-1),this.sCurDragVal=w,this.sCurDragVal}SliderMouseOut(){this.RemoveSliderEvent(),null!=this.sEndAction&&this.sEndAction(this.sCurDragVal),this.Init()}}var w=new class{ERR(e,t,i){let s=i;"object"==typeof i&&(s=JSON.stringify(i)),this.list=e.owner.ceshi_log_list,this.list.vScrollBarSkin="",a.errList.push({tip:t,value:s}),this.list.array=a.errList,this.list.renderHandler=new Laya.Handler(this,this.listtOnRender)}listtOnRender(e){let t=e.getChildByName("value");e.getChildByName("tip").text=e.dataSource.tip,t.text=e.dataSource.value}};var _=new class{reload(e){w.ERR(e,"start-----Date",(new Date).getTime()),e.showDiChiMang(!1),e.showDiChiPi(!1),e.owner.getChildByName("me_handleBox")._children.forEach(e=>{e.visible=!1}),e.owner.me_sub_pokerBox.visible=!1,e.owner.subCountDown.visible=!1,e.owner.meAnimationBox.visible=!1,e.owner.delayTimeBtn.visible=!1,e.owner.returnSeatBtn.visible=!1,e._playerArray.forEach((t,i)=>{let a=t.owner;e._plyerIndexArray[t.INDEX]=t.INDEX,a.userId="",a.mePokerX_2=[],a.mePokerX_3=[],a.mePokerX_4=[],a.sub1=[],a.sub2=[],a.sub1Point="",a.sub2Point="",a.isMe=!1,a.showXiaZhuScore=!1,a.xiaZhuScore=0,a.index=t.INDEX,a.seatId=t.INDEX,a.x=e.owner._playerSeatXYArray[t.INDEX].x,a.y=e.owner._playerSeatXYArray[t.INDEX].y,a.getChildByName("xiaZhuScore").x=e.owner._xiaZhuSeatXYArray[t.INDEX].x,a.getChildByName("xiaZhuScore").y=e.owner._xiaZhuSeatXYArray[t.INDEX].y,a.getChildByName("tipsBox").x=e.owner._tipsSeatXYArray[t.INDEX].x,a.getChildByName("tipsBox").y=e.owner._tipsSeatXYArray[t.INDEX].y,a.getChildByName("show_poker_box").x=e.owner._pokerBoxSeat[t.INDEX].x,a.getChildByName("show_poker_box").y=e.owner._pokerBoxSeat[t.INDEX].y,a.getChildByName("create_cm_seat")._children.forEach(i=>{i.x=e.owner._showCMFaceToPlayerXY[t.INDEX].x,i.y=e.owner._showCMFaceToPlayerXY[t.INDEX].y}),a.getChildByName("sub_poker_box").x=e.owner._subPokerBoxSeat[t.INDEX].x,a.getChildByName("sub_poker_box").y=e.owner._subPokerBoxSeat[t.INDEX].y,a._showCMFaceToPlayerXY.x=e.owner._showCMFaceToPlayerXY[t.INDEX].x,a._showCMFaceToPlayerXY.y=e.owner._showCMFaceToPlayerXY[t.INDEX].y,a._mangDiChiFaceToPlayerXY.x=e.owner._mangDiChiFaceToPlayerXYArray[t.INDEX].x,a._mangDiChiFaceToPlayerXY.y=e.owner._mangDiChiFaceToPlayerXYArray[t.INDEX].y,a._piDiChiFaceToPlayerXY.x=e.owner._piDiChiFaceToPlayerXYArray[t.INDEX].x,a._piDiChiFaceToPlayerXY.y=e.owner._piDiChiFaceToPlayerXYArray[t.INDEX].y,a.getChildByName("fastChatBox").x=e.owner._fastChatBoxSeat[t.INDEX].x,a.getChildByName("fastChatBox").y=e.owner._fastChatBoxSeat[t.INDEX].y,a._fastChatBoxSeatBgImg=e.owner._fastChatBoxSeatBgImg[t.INDEX];let s=a.getChildByName("head-box"),o=s.getChildByName("headBg").getChildByName("head"),n=a.getChildByName("xiaZhuScore"),r=a.getChildByName("deal_cards_seat"),h=a.getChildByName("deal_cards_seat34"),l=a.getChildByName("create_cm_seat").getChildByName("move_cm"),d=(a.getChildByName("create_cm_seat").getChildByName("move_cm"),a.getChildByName("sub_poker_box")),c=a.getChildByName("score"),g=a.getChildByName("banker"),m=a.getChildByName("name"),p=a.getChildByName("countDownBox"),y=a.getChildByName("show_me_poker_box"),u=a.getChildByName("show_me_sub_poker"),w=a.getChildByName("xiuPokerBox"),_=a.getChildByName("gifBox"),C=a.getChildByName("winScore"),S=a.getChildByName("tipsBox"),L=a.getChildByName("liuzuoSign");a.getChildByName("fastChatBox").visible=!1,L.visible=!1,s.visible=!1,n.visible=!1,l.visible=!1,u.visible=!1,r._children.forEach(e=>{e.visible=!1}),h._children.forEach(e=>{e.visible=!1}),y._children.forEach(e=>{e.visible=!1}),o.skin="",S.loadImage(""),d.visible=!1,c.visible=!1,g.visible=!1,p.visible=!1,w.visible=!1,_.visible=!1,C.visible=!1,m.text=""})}};class C extends Laya.Script{constructor(){super(),this._music={moveShow:"res/sounds/chips_to_table.wav",moveMangOrPi:"res/sounds/chips_to_pot.wav",dealCards:"res/sounds/movecard.mp3",fanCards:"res/sounds/card_turning.wav",handle:"res/sounds/handle.wav",diu:"res/sounds/diu.wav",sub:"res/sounds/sub.wav",subTimeOut:"res/sounds/timeout.wav",subEnd:"res/sounds/pcheck.wav",xiu:"res/sounds/pcheck.wav",YouWin:"res/sounds/YouWin.wav",daSlider:"res/sounds/slider.wav",daSliderTop:"res/sounds/slider_top.wav"},this._betType={mang:1,pi:2},this.autoHandle={left:1,right:2},this._moveCMSeat={one:1,show:2,mang:3,pi:4},this._bindPokerData={poker12:1,poker3:2,poker4:3,poker34:4},this._changeScoreType={seat:1,xiaZhu:2},this._speed={changeSeatSpeed:180,moveCM:260,delayCard:100,moveCard:200,fanCard:100,xiuFan:200,diu:500,diuRotation:300,handle:120,winCMDelay:500,winShowDelay:500},this.delayType={action:1,sub:2},this._allowStartAction=!0,this._isUpdateData=!1,this.StartAssignPokerArr=[],this.qiaoDealPokerEnd=!1,this.soketConnetNum=0,this.isLiuZuo=!1}$LOG(...e){a.debug&&console.log(...e)}onAwake(){C.instance=this}onStart(){a.$LOG("游戏控制中心:",this,this.owner._openedData),this._subCountDownVal=this.owner.subCountDown.getChildByName("timeText").getChildByName("timeVal"),this._subCountDownLineTop=this.owner.subCountDown.getChildByName("lineBox")._children[0].getChildByName("line_top"),this._subView1=this.owner.me_sub_pokerBox.getChildByName("poker1Box").getChildByName("poker"),this._subView2=this.owner.me_sub_pokerBox.getChildByName("poker2Box").getChildByName("poker"),this._subPoint1Text=this.owner.me_sub_pokerBox.getChildByName("point1Text"),this._subPoint2Text=this.owner.me_sub_pokerBox.getChildByName("point2Text"),this._confrimSubBtn0=this.owner.confrimSubBtn0,this._confrimSubBtn1=this.owner.confrimSubBtn1,this.setGameParamInit()}setGameParamInit(){this.userId=a.userInfo.userId,this.roomPwd=this.owner._openedData.roomPws,this.roomId="",this.netClient=new r("ws://"+a.websoketApi),this.onConnect()}onEnable(){let e=0,t=this;this.openDiaLogSpeed=200,this._playerArray=[],this._plyerIndexArray=[],t._seatXY=[],this.$LOG("控制中心:",this),m.init(t),l.req({key:"seat",callback(i){i.INDEX=e++,t._playerArray.push(i),t._plyerIndexArray.push(i.INDEX),setTimeout(()=>{m.keepValue(t,i)})}})}changeSeatXY(e,t){let i=[],a=this.owner.deskView._children.filter(e=>-1!=e.name.indexOf("empty-seat"));for(let e=0;e<a.length;e++)i.push(e);let s=i.splice(e,a.length).concat(i.splice(0,e+1));for(let i=0;i<s.length;i++){this._playerArray[s[i]].owner.isMe=!1,this._playerArray[e].owner.isMe=!0,Laya.Tween.to(this._playerArray[s[i]].owner,{x:this.owner._playerSeatXYArray[i].x,y:this.owner._playerSeatXYArray[i].y},t,null,Laya.Handler.create(this,()=>{})),Laya.Tween.to(this._playerArray[s[i]].owner.getChildByName("xiaZhuScore"),{x:this.owner._xiaZhuSeatXYArray[i].x,y:this.owner._xiaZhuSeatXYArray[i].y},t,null),Laya.Tween.to(this._playerArray[s[i]].owner.getChildByName("tipsBox"),{x:this.owner._tipsSeatXYArray[i].x,y:this.owner._tipsSeatXYArray[i].y},t,null),this._playerArray[s[i]].owner.getChildByName("show_poker_box").x=this.owner._pokerBoxSeat[i].x,this._playerArray[s[i]].owner.getChildByName("show_poker_box").y=this.owner._pokerBoxSeat[i].y;this._playerArray[s[i]].owner.getChildByName("create_cm_seat")._children.forEach(e=>{Laya.Tween.to(e,{x:this.owner._showCMFaceToPlayerXY[i].x,y:this.owner._showCMFaceToPlayerXY[i].y},t)});Laya.Tween.to(this._playerArray[s[i]].owner.getChildByName("sub_poker_box"),{x:this.owner._subPokerBoxSeat[i].x,y:this.owner._subPokerBoxSeat[i].y},t,null),this._playerArray[s[i]].owner._showCMFaceToPlayerXY.x=this.owner._showCMFaceToPlayerXY[i].x,this._playerArray[s[i]].owner._showCMFaceToPlayerXY.y=this.owner._showCMFaceToPlayerXY[i].y,this._playerArray[s[i]].owner._mangDiChiFaceToPlayerXY.x=this.owner._mangDiChiFaceToPlayerXYArray[i].x,this._playerArray[s[i]].owner._mangDiChiFaceToPlayerXY.y=this.owner._mangDiChiFaceToPlayerXYArray[i].y,this._playerArray[s[i]].owner._piDiChiFaceToPlayerXY.x=this.owner._piDiChiFaceToPlayerXYArray[i].x,this._playerArray[s[i]].owner._piDiChiFaceToPlayerXY.y=this.owner._piDiChiFaceToPlayerXYArray[i].y,this._playerArray[s[i]].owner.getChildByName("fastChatBox").x=this.owner._fastChatBoxSeat[i].x,this._playerArray[s[i]].owner.getChildByName("fastChatBox").y=this.owner._fastChatBoxSeat[i].y,this._playerArray[s[i]].owner._fastChatBoxSeatBgImg=this.owner._fastChatBoxSeatBgImg[i],g.init(this._playerArray[s[i]].owner)}}onConnect(){let e=this;this.netClient.open(),this.netClient.onConnectSucc=function(){a.$LOG("连接成功"),e.onSend({name:"M.User.C2G_Connect",data:{uid:a.userInfo.userId,key:a.userInfo.key,devid:Laya.Browser.onAndroid?"Android":"PC",ip:"60.255.161.15"},success(t){a.$LOG("初始化---[Rpc回调]:",t),"G2C_Connect"==t._t&&(0==t.ret.type?(_.reload(this),a.showLoading(!1,a.loadingType.two),this.soketConnetNum=0,this.onSend({name:"M.Room.C2R_IntoRoom",data:{roomPws:e.roomPwd},success(t){e.dealSoketMessage("初始化---C2R_IntoRoom进入房间",t)}})):a.showDiaLog(t.ret.msg,1,()=>{e.onClose(),Laya.Scene.open("login.scene",!0,a.sign.signOut)}))}}),e.netClient.onMessage=function(t,i){e.dealSoketMessage("onMessage公共消息：",i)},e.netClient.onStartConnect=function(t){a.errList=[],a.$LOG("soket重新连接开始"),a.showLoading(!0,a.loadingType.two),e.soketConnetNum++,e.soketConnetNum>=15?(a.showLoading(!1,a.loadingType.two),e.soketConnetNum=0,a.showDiaLog("网络错误,请重新登录",1,()=>{e.onClose(),Laya.Scene.open("login.scene",!0,a.sign.signOut)})):1==e.soketConnetNum&&a.showTip("检测到网络丢失!")}}}onSend(e){let t=this,i=e.name,s=e.data;this.netClient.send({name:i,data:s,callback:function(i,a){e.success.call(t,a)}}),a.$LOG("soket发送消息:",e)}onClose(){a.showLoading(!1,a.loadingType.two),this.netClient.close()}getGameNews(e){this._gameRoomeNews=e.option,this.setRoomData(e)}setRoomData(e){this.owner.rule_roomPws.text=e.roomPws,this.owner.rule_roomName.text=e.roomName,this.owner.rule_pi.text="皮："+e.option.dizhu,this.owner.rule_ruleText2_9.text=e.option.dy29?"2/9地王":"",e.option.xmzm&&e.option.yxqm?this.owner.rule_ruleText.text="休芒/揍芒/圈芒 ×"+e.option.mangrate:e.option.xmzm&&!e.option.yxqm?this.owner.rule_ruleText.text="休芒/揍芒 ×"+e.option.mangrate:!e.option.xmzm&&e.option.yxqm?this.owner.rule_ruleText.text="圈芒 ×"+e.option.mangrate:e.option.xmzm||e.option.yxqm||(this.owner.rule_ruleText.text="")}dealSoketMessage(e,t){try{a.$LOG(e,t),"GenalResult"==t._t&&this.errOpenLoginView(t),"R2C_IntoRoom"==t._t&&(0==t.ret.type?this.requestRoomUpdateData(t):(a.showTip(t.ret.msg),this.leaveRoomOpenView())),"R2C_UpdateRoom"==t._t&&(0==t.ret.type?t.param.json.forEach(e=>{"CXIntoRoom"==e._t?(this.getGameNews(e),this.updateRoomData(e,t)):"UpdateRoomData"==e._t&&this.updateCurData(e,t)}):a.showTip(t.ret.msg)),"R2C_AddDairu"==t._t&&(0!=t.ret.type&&4!=t.ret.type||(this.setMeMakeBOBO(t),t.param.json.forEach(e=>{"CXAddBobo"==e._t&&this.playerAddDairu(e)})),0!=t.ret.type&&a.showTip(t.ret.msg)),"R2C_SeatAt"==t._t?0==t.ret.type?t.param.json.forEach(e=>{"CXSeatAt"==e._t?this.playerSeatAt(e):"CXSitDown"==e._t&&this.playerSeatDown(e)}):a.showTip(t.ret.msg):"R2C_SeatUp"==t._t?0==t.ret.type?this.playerSeatUp(t):a.showTip(t.ret.msg):"R2C_SitDown"==t._t?0==t.ret.type?t.param.json.forEach(e=>{this.playerSeatDown(e)}):a.showTip(t.ret.msg):"R2C_LeaveRoom"==t._t?4==t.ret.type?a.showTip(t.ret.msg):this.leaveRoomDeal(t):"CXRoomEnd"==t._t&&this.roomEnd(t),"G2C_TimeDelay"==t._t?p.dealWithRes(this,t):"G2C_StartNewRound"==t._t?this.startNewRound(t):"G2C_BetPiAndMango"==t._t?this.betPiAndMango(t):"G2C_Deal"==t._t?(this._startAction=null,0==t.type?(this.playerBindPoker12Val(t),this._isUpdateData&&this.startDealPoker1And2()):1==t.type?this.playerBindPoker3Or4Val(t,3):2==t.type?(this.qiaoDealPokerEnd=!1,this.StartAssignPokerArr=[],this.playerBindPoker3Or4Val(t,4)):3==t.type&&(this._allowStartAction=!0,this.qiaoDealPokerEnd=!1,this.playerBindPoker34Val(t))):"G2C_StartAction"==t._t?(this._startAction=t,0==t.ret.type?this.startAction():6==t.ret.type&&(a.showTip(t.ret.msg),this.sanhuaAction(t))):"G2C_PlayerAction"==t._t?this.playerAction(t):"G2C_PlayerActionEnd"==t._t?(this.qiaoDealPokerEnd=!0,this.playerActionEnd(t)):"G2C_StartAssignPoker"==t._t?(this.StartAssignPokerArr=[],this.qiaoDealPokerEnd?(this.assignPokerCountDown(!0,t),this.startAssignPoker(!0,!1,t)):this.StartAssignPokerArr=[{data:t}]):"G2C_AssignPoker"==t._t?0==t.ret.type?this.assignPokerReturn(t):a.showTip(t.ret.msg):"G2C_WinUp"==t._t?this.playerWinUp(t):"G2C_RecyclingMang"==t._t?this.recyclingMang(t):"G2C_RoundEnd"==t._t&&this.roundEnd(t),"G2C_GameChat"==t._t&&(2==t.chat.msgType?this.showPlayerExpression(t):1==t.chat.msgType&&this.showPlayerFastVoice(t)),"R2C_Reservation"==t._t&&(0==t.ret.type?t.param.json.forEach(e=>{"CXSeatReservation"==e._t?this.playerLiuZuo(e):"CXSitDown"==e._t&&(this.isLiuZuo=!1,this.playerSeatDown(e))}):a.showTip(t.ret.msg))}catch(e){a.$LOG("error",e),w.ERR(this,"try-catc处异常：",e)}}showPlayerFastVoice(e){this._playerArray.forEach(t=>{t.owner.userId==e.chat.sender&&t.playerSeatAddFastChat(e.chat)})}showPlayerExpression(e){this._playerArray.forEach(t=>{t.owner.userId==e.chat.sender&&t.playerSeatAddExpression(!0,e.chat.content,!0)})}errOpenLoginView(e){a.showDiaLog("登录失效，请重新登录",1,()=>{Laya.Scene.open("login.scene",!0,a.sign.signOut,Laya.Handler.create(this,()=>{this.destroy()}))})}requestRoomUpdateData(e){this.roomId=e.roomId,this.onSend({name:"M.Room.C2R_UpdateRoom",data:{roomId:this.roomId},success(e){this.dealSoketMessage("进入房间收到的消息：",e)}})}roomEnd(e){Laya.Scene.open("paiJuEndView.scene",!1,{show:!0,data:e,page:this.owner._openedData.page})}updateRoomData(e,t){w.ERR(this,"更新座位上的数据Date",(new Date).getTime()),this._allowStartAction=!0,this._totalMango=e.mang,this._totalPi=e.dichi,e.mang&&this.showDiChiMang(!0),e.dichi>0&&(this.showDiChiPi(!0),this._isUpdateData=!0),this._dealNumber=0;let i=e.roomSeat.filter(e=>e._id==this.userId);i.length>0?(this.newIndexConcatArr=this._plyerIndexArray.splice(i[0].seat_idx,this._plyerIndexArray.length).concat(this._plyerIndexArray.splice(0,i[0].seat_idx+1)),this._playerArray.forEach((e,t)=>{e.owner.seatId=this.newIndexConcatArr[t]})):this.newIndexConcatArr=this._plyerIndexArray,e.roomSeat.forEach(i=>{i.seatidx=i.seat_idx,i.userId=i._id,i.seatAtTime>0&&0==i.score?this.playerSeatAt(i):0==i.seatAtTime&&this.playerSeatDown(i),i.seatAtTime>0&&0!=i.score&&i.seatReservation&&(this.playerSeatDown(i),this.playerLiuZuo(i)),this._playerArray.forEach((s,o)=>{if(g.init(s.owner),i.userId==s.owner.userId){if(s.owner.isMe&&(s.owner.actionType=-1),i.xiazhu>0&&(s.showOrHidePlayerXiaZhuView(!0),s.changePlayerScore(i.score,this._changeScoreType.seat),s.changePlayerScore(i.xiazhu,this._changeScoreType.xiaZhu)),i.xiazhu>0&&!i.isAction?s.changeShowCM(this,2,!0,null):i.xiazhu>0&&i.isAction&&s.changeShowCM(this,3,!0,null),3==i.action&&s.changeShowCM(this,0,!0,null),i.assignPoker){s.showActionTip(!0,6),this._showSubView=!1,this.startAssignPoker(!1);let e=[i.pokers[0],i.pokers[1]],t=[i.pokers[2],i.pokers[3]],a=n.countPoint(i.pokers[0],i.pokers[1]),o=n.countPoint(i.pokers[2],i.pokers[3]);s.showPlayerSubResult(!0,{sub1:{data:e,point:a},sub2:{data:t,point:o}})}else{let n=t.param.json.filter(e=>"UpdateRoomData"==e._t),r=[];0!=n.length&&(r=n[0].curData.filter(e=>"G2C_StartAssignPoker"==e._t)),0==r.length?(i.action>0&&(s.showActionTip(!0,i.action),5==i.action&&s.playerSeatAddGif(!0,a.animations.qiao)),this._allowXiuPoker=!0):this._allowXiuPoker=!1,w.ERR(this,"重置牌数据"+i.userId,i.pokers),i.pokers.length>0&&(this._isUpdateData=!1),i.pokers.forEach((t,i)=>{s.dealPoker(this,i+1,e.roomSeat.length,t,o,!0)})}s.owner.isMe&&s.showPlayerXiuSign(i.showPoker)}})})}updateCurData(e,t){e.curData.forEach(e=>{if("G2C_StartAction"==e._t)this._startAction=e,this._allowStartAction=!0,this.startAction();else if("G2C_StartAssignPoker"==e._t){this.assignPokerCountDown(!0,e);let i=t.param.json.filter(e=>"CXIntoRoom"==e._t)[0].roomSeat.filter(e=>e.userId==this.userId&&!e.assignPoker);e.players.filter(e=>i.find(t=>t.userId==e)).length>0&&this.startAssignPoker(!0,!0,e)}})}ceShi(){}clearQiaoAni(){this._playerArray.forEach(e=>{e.playerSeatAddGif(!1,a.animations.qiao)})}setMoreStartVal(){this._allowXiuPoker=!0,this._allowStartAction=!1,this.qiaoDealPokerEnd=!1,this.autoHandleType=null,this._allowAssignPoker=!1}startNewRound(e){this.roundEnd(),this.setMoreStartVal(),this.clearQiaoAni(),this.setPlayerActionZT(e.seats);let t=e.seats.filter(t=>t.seat_idx==e.zidx);this._playerArray.forEach(e=>{e.owner.userId==t[0]._id?e.showBanker(!0):e.showBanker(!1)})}setPlayerActionZT(e){this._playerArray.filter(t=>e.find(e=>e._id==t.owner.userId)).forEach(e=>{e.owner.actionType=-1})}betPiAndMango(e){this._totalMango=e.totalMango,this._totalPi=e.totalPi,this._joinPlyerArray=e.betUserInfo,e.betUserInfo.forEach((t,i)=>{this._playerArray.forEach(a=>{t.userId==a.owner.userId&&(a.changePlayerScore(t.score,this._changeScoreType.seat),a.changeShowCM(this,1,!0,e.betUserInfo.length,i,this.showPlayerScoreAndCMEnd),a.bindPlayerXiaZhuScoreVal(t,this._betType.mang))})})}showPlayerScoreAndCMEnd(){this._winUpINDEX=0,this._joinPlyerArray.forEach((e,t)=>{this._playerArray.forEach(t=>{e.userId==t.owner.userId&&t.showMoveCM(this,1,!0,this._moveCMSeat.one,this._moveCMSeat.show,this._music.moveShow,this._joinPlyerArray.length,this.startShortMoveEnd)})})}startShortMoveEnd(){this._winUpINDEX=0,setTimeout(()=>{this._joinPlyerArray.forEach((e,t)=>{this._playerArray.forEach(t=>{e.userId==t.owner.userId&&(t.showOrHidePlayerXiaZhuView(!1),t.showMoveCM(this,1,!0,this._moveCMSeat.show,this._moveCMSeat.mang,this._music.moveMangOrPi,this._joinPlyerArray.length,this.moveToMangEnd))})})},300)}moveToMangEnd(){this.showDiChiMang(!0),setTimeout(()=>{this._joinPlyerArray.forEach((e,t)=>{this._playerArray.forEach(i=>{e.userId==i.owner.userId&&(i.changeShowCM(this,2,!0,this._joinPlyerArray.length,t,this.showPlayerScoreAndCMEnd2),i.bindPlayerXiaZhuScoreVal(e,this._betType.pi))})})},400)}showPlayerScoreAndCMEnd2(){this._winUpINDEX=0,this._joinPlyerArray.forEach((e,t)=>{this._playerArray.forEach(t=>{e.userId==t.owner.userId&&t.showMoveCM(this,2,!0,this._moveCMSeat.one,this._moveCMSeat.show,this._music.moveShow,this._joinPlyerArray.length,this.startShortMoveEnd2)})})}startShortMoveEnd2(){this.showDiChiPi(!0),setTimeout(()=>{this.startDealPoker1And2()},300)}playerBindPoker12Val(e){this._dealPoker12Array=e.players}playerBindPoker3Or4Val(e,t){this._allowStartAction=!1,this._dealNumber=0;let i=e.players.length;e.players.forEach((e,a)=>{this._playerArray.forEach(s=>{if(s.owner.userId==e.uid){let o=e.poker[0];s.dealPoker(this,t,i,o,a,!1,this.dealPokerEnd)}})})}playerBindPoker34Val(e){let t=e.players.length;this._dealNumber=0;for(let i=3;i<=4;i++)e.players.forEach((e,s)=>{this._playerArray.forEach(o=>{if(o.owner.userId==e.uid){let n=i,r=s+(n-3)*t,h=3==n?e.poker[0]:e.poker[1];o.dealPoker(this,n,t,h,r,!1,function(){4==n?(a.$LOG("敲发34结束：",n),this.qiaoDeal34PokerEnd()):this._dealNumber=0})}})})}qiaoDeal34PokerEnd(){this.qiaoDealPokerEnd=!0,a.$LOG("进来分牌数据=====================：",this.StartAssignPokerArr),this.StartAssignPokerArr.forEach(e=>{this.assignPokerCountDown(!0,e.data),this.startAssignPoker(!0,!1,e.data)})}showDiChiMang(e){this.owner.mang_cm_pool.visible=e,e&&this.bindDiChiMangVal()}bindDiChiMangVal(e){this.owner.mang_cm_pool.getChildByName("dichimangVal").text=e||this._totalMango}showDiChiPi(e){this.owner.pi_cm_pool.visible=e,e&&this.bindDiChiPiVal()}bindDiChiPiVal(e){this.owner.pi_cm_pool.getChildByName("dichipiVal").text=e||this._totalPi}startAction(){w.ERR(this,"操作游戏按钮显示状态：",this._allowStartAction),this._allowStartAction&&this._startAction&&this._playerArray.forEach(e=>{this._startAction.uid!=this.userId?this.setPlayerAutoHandleZT(!0,e):this.setPlayerAutoHandleZT(!1,e),e.owner.userId==this._startAction.uid&&(e.showActionTip(!1),e.showPlayerCountDown(this._startAction,!0),a.$LOG("自动操作状态======",this.autoHandleType),this.setMeCurHandleZT(this._startAction,e))})}setMeCurHandleZT(e,t){if(t.owner.isMe)if(this.autoHandleType){let t=e.opts.filter(e=>4==e);t.length>0&&this.autoHandleType==this.autoHandle.right||t.length>0&&this.autoHandleType==this.autoHandle.left?this.onClickRightBtn(4,0):0==t.length&&this.autoHandleType==this.autoHandle.right?this.setMeHandleBtnZT(!0,e):0==t.length&&this.autoHandleType==this.autoHandle.left&&this.onClickLeftBtn(3)}else this.setMeHandleBtnZT(!0,e)}sanhuaAction(e){this._playerArray.forEach(t=>{t.owner.userId==e.uid&&t.diuPoker()})}setPlayerAutoHandleZT(e,t){if(e||(this.owner.autoHandleBtnBox.visible=e),t){let i=this.owner.autoHandleBtnBox.visible,a=t.owner.actionType,s=parseInt(t.owner.curXiaZhuScore);if(t.owner.isMe&&!i&&e&&a&&3!=a&&5!=a&&s>0){this._autoBtnArr=[],this.owner.autoHandleBtnBox.visible=e;let t=this.owner.auto_handle_left,i=this.owner.auto_handle_right,a=t.getChildByName("auto_0"),s=t.getChildByName("auto_1"),o=i.getChildByName("auto_0"),n=i.getChildByName("auto_1");this.meHandleBtnCommonSet(t,{x:-280,y:0}),this.meHandleBtnCommonSet(i,{x:280,y:0}),this.loadAutoHandleImgEnd(t,a,s),this.loadAutoHandleImgEnd(i,o,n),this.autoHandleType=null,t.on(Laya.Event.CLICK,this,this.onClickAutoLeftBtn,[a,s,o,n]),i.on(Laya.Event.CLICK,this,this.onClickAutoRightBtn,[a,s,o,n])}}}onClickAutoLeftBtn(e,t,i,a){e.visible=!e.visible,t.visible=!t.visible,i.visible=!0,a.visible=!1,this.autoHandleType=t.visible?this.autoHandle.left:null}onClickAutoRightBtn(e,t,i,a){i.visible=!i.visible,a.visible=!a.visible,e.visible=!0,t.visible=!1,this.autoHandleType=a.visible?this.autoHandle.right:null}loadAutoHandleImgEnd(e,t,i){t.visible=!0,i.visible=!1,this._autoBtnArr.push(e),2==this._autoBtnArr.length&&this._autoBtnArr.forEach(e=>{Laya.Tween.to(e,{x:e.moveXY.x,y:e.moveXY.y,alpha:1},this._speed.handle,Laya.Ease.backInOut,Laya.Handler.create(this,this.moveAutoHandleEnd))})}moveAutoHandleEnd(){}meHandleBtnCommonSet(e,t){let i=e;i.alpha=0,i.pos(0,0),i.moveXY=t}setMeHandleBtnZT(e=!0,t){if(a.$LOG("进来操作状态======:",e,t),this.owner.handleBtnBox.visible=e,p.init(this.delayType.action,this,t),e){this._btnArr=[],this._btnMoveNum=0;let e=this.owner.handle_left,i=this.owner.handle_right,a=this.owner.handle_top;this.meHandleBtnCommonSet(e,{x:-280,y:0}),this.meHandleBtnCommonSet(i,{x:280,y:0}),this.meHandleBtnCommonSet(a,{x:0,y:-180}),this.loadHandleImgEnd(e,t),e.on(Laya.Event.CLICK,this,this.onClickLeftBtn,[3]);{let e=t.opts.filter(e=>2==e||4==e);if(1==e.length){let a,s=i.getChildByName("gen_btn").getChildByName("value");s.text="",i._children.forEach(e=>{e.visible=!1}),2==e[0]?i.getChildByName("gen_btn").visible=!0:4==e[0]&&(i.getChildByName("xiu_btn").visible=!0),this.loadHandleImgEnd(i,t),a=t.xiazu+t.score>=t.maxXiazu?2==e[0]?t.maxXiazu:0:2==e[0]?t.xiazu+t.score:0,i.on(Laya.Event.CLICK,this,this.onClickRightBtn,[e[0],a]),2==e[0]&&(s.text=t.score<=a?t.score:t.maxXiazu-t.xiazu)}}{let e=t.opts.filter(e=>1==e||5==e||6==e);if(1==e.length)if(a._children.forEach(e=>{e.visible=!1}),1==e[0]?a.getChildByName("da_btn").visible=!0:5==e[0]?a.getChildByName("qiao_btn").visible=!0:6==e[0]&&(a.getChildByName("NOda_btn").visible=!0),this.loadHandleImgEnd(a,t),1==e[0]||5==e[0]){let i=5==e[0]?t.score:null;a.getChildByName("qiao_btn").getChildByName("value").text="",5==e[0]&&(a.getChildByName("qiao_btn").getChildByName("value").text=i),a.on(Laya.Event.CLICK,this,this.onClickTopBtn,[e[0],i]),1==e[0]?a.on(Laya.Event.MOUSE_DOWN,this,this.onClickTopBtn,[e[0],t]):a.off(Laya.Event.MOUSE_DOWN,this,this.onClickTopBtn)}else 6==e[0]&&(a.off(Laya.Event.CLICK,this,this.onClickTopBtn),a.off(Laya.Event.MOUSE_DOWN,this,this.onClickTopBtn))}}else this.showFastBtnAndBindVal(!1),p.offEvent(this)}loadHandleImgEnd(e,t){this._btnArr.push(e),3==this._btnArr.length&&this._btnArr.forEach(e=>{Laya.Tween.to(e,{x:e.moveXY.x,y:e.moveXY.y,alpha:1},this._speed.handle,Laya.Ease.backInOut,Laya.Handler.create(this,this.moveHandleEnd,[t]))})}moveHandleEnd(e){this._btnMoveNum++,3==this._btnMoveNum&&(this.showFastBtnAndBindVal(!0,e),1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(this._music.handle,1))}showMeHandleTip(e){this._playerArray.forEach(t=>{t.owner.isMe&&t.showActionTip(!0,e)})}onClickLeftBtn(e){this.showMeHandleTip(e),this.setMeHandleBtnZT(!1,null),3==e&&this.onSend({name:"M.Games.CX.C2G_PlayerAction",data:{roomId:this.roomId,score:0,act:e},success(e){this.dealSoketMessage("操作按钮的点击事件--丢：",e)}})}onClickRightBtn(e,t){this.showMeHandleTip(e),this.setMeHandleBtnZT(!1,null),this.onSend({name:"M.Games.CX.C2G_PlayerAction",data:{roomId:this.roomId,score:t,act:e},success(e){this.dealSoketMessage("操作按钮的点击事件--跟或休：",e)}})}onClickTopBtn(e,t){let i=this;if(5==e)this.showMeHandleTip(e),this.setMeHandleBtnZT(!1,null),this._playerArray.forEach(e=>{e.owner.isMe&&e.playerSeatAddGif(!0,a.animations.qiao)}),this.daSendSoket(t,e);else if(1==e){w.ERR(this,"大----处值：data",t),this.owner.da_slider.getComponent(u).SliderMouseDown(2*t.maxXiazu+t.xiazu,t.score+t.xiazu,e=>{a.$LOG("变化值的时候回调：",e),i.daSliderChangeDeal(e,t)},s=>{a.$LOG("结束的的时候回调：",s),0!=s&&(i.showMeHandleTip(e),i.setMeHandleBtnZT(!1,null),w.ERR(this,"大----处回调的分数：data",t),i.daSendSoket(s,e))})}}daSendSoket(e,t){this.onSend({name:"M.Games.CX.C2G_PlayerAction",data:{roomId:this.roomId,score:e,act:t},success(e){this.dealSoketMessage("操作按钮的点击事件--跟或休：",e)}})}daSliderChangeDeal(e,t){1==a.gameSetVal.gameMusic&&(e<t.score?Laya.SoundManager.playSound(this._music.daSlider,1):Laya.SoundManager.playSound(this._music.daSliderTop,1))}hideOrShowFastBtn(e,t){e.getChildByName("btn1").visible=1==t,e.getChildByName("btn0").visible=0==t}showFastBtnAndBindVal(e,t){if(this.owner.fastXiaZhuBtnBox.visible=e,e){let e=this.owner.fastXiaZhuBtnBox.getChildByName("btn1"),i=this.owner.fastXiaZhuBtnBox.getChildByName("btn2"),a=this.owner.fastXiaZhuBtnBox.getChildByName("btn3"),s=e.getChildByName("value"),o=i.getChildByName("value"),n=a.getChildByName("value");this._gameRoomeNews.dizhu==t.maxXiazu?(s.text=parseInt(this._totalPi/2),s.alpha=.5,o.text=parseInt(2*s.text),o.alpha=1,n.text=parseInt(4*s.text),n.alpha=1,this.hideOrShowFastBtn(e,0),this.hideOrShowFastBtn(i,1),this.hideOrShowFastBtn(a,1),this._allowFast1=!1,this._allowFast2=!0,this._allowFast3=!0,i.on(Laya.Event.CLICK,this,this.onClickFastBtn,[o.text,"_allowFast2"]),a.on(Laya.Event.CLICK,this,this.onClickFastBtn,[n.text,"_allowFast3"])):(s.text=parseInt(2*t.maxXiazu),o.text=2*s.text,n.text=4*s.text,s.text>t.score?(this._allowFast1=!1,s.alpha=.5,this.hideOrShowFastBtn(e,0)):(s.alpha=1,this._allowFast1=!0,this.hideOrShowFastBtn(e,1),e.on(Laya.Event.CLICK,this,this.onClickFastBtn,[s.text,"_allowFast1"])),o.text>t.score?(this._allowFast2=!1,o.alpha=.5,this.hideOrShowFastBtn(i,0)):(o.alpha=1,this._allowFast2=!0,this.hideOrShowFastBtn(i,1),i.on(Laya.Event.CLICK,this,this.onClickFastBtn,[o.text,"_allowFast2"])),n.text>t.score?(n.alpha=.5,this._allowFast3=!1,this.hideOrShowFastBtn(a,0)):(n.alpha=1,this._allowFast3=!0,this.hideOrShowFastBtn(a,1),a.on(Laya.Event.CLICK,this,this.onClickFastBtn,[n.text,"_allowFast3"])))}}onClickFastBtn(e,t){a.$LOG("点击快捷键状态：",this[t]),this[t]&&this.onSend({name:"M.Games.CX.C2G_PlayerAction",data:{roomId:this.roomId,score:e,act:1},success(e){this.dealSoketMessage("快捷按钮的点击事件:",e)}})}playerAction(e){null==e.ret||0==e.ret.type?this._playerArray.forEach(t=>{if(t.owner.userId==e.uid)switch(this.prePlayerAciton=e.act,t.showActionTip(!0,e.act),t.showPlayerCountDown(null,!1),t.owner.isMe&&this.setMeHandleBtnZT(!1,null),e.act){case 3:t.diuPoker(),t.changeShowCM(this,0,!0,1,0);break;case 1:;this._winUpINDEX=0,t.changePlayerScore(e.playerScore,this._changeScoreType.seat),t.showMoveCM(this,3,!0,this._moveCMSeat.one,this._moveCMSeat.show,this._music.moveShow,1,function(){t.changePlayerScore(e.score,this._changeScoreType.xiaZhu),this.bindDiChiPiVal(e.dichi),t.changeShowCM(this,3,!0,1,0)});break;case 2:;this._winUpINDEX=0,t.changePlayerScore(e.playerScore,this._changeScoreType.seat),t.showMoveCM(this,3,!0,this._moveCMSeat.one,this._moveCMSeat.show,this._music.moveShow,1,function(){t.changePlayerScore(e.score,this._changeScoreType.xiaZhu),this.bindDiChiPiVal(e.dichi),t.changeShowCM(this,3,!0,1,0)});break;case 4:1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(this._music.xiu,1);break;case 5:;this._winUpINDEX=0,t.playerSeatAddGif(!0,a.animations.qiao,!1),t.changePlayerScore(e.playerScore,this._changeScoreType.seat),t.showMoveCM(this,3,!0,this._moveCMSeat.one,this._moveCMSeat.show,this._music.moveShow,1,function(){t.changePlayerScore(e.score,this._changeScoreType.xiaZhu),this.bindDiChiPiVal(e.dichi),t.changeShowCM(this,3,!0,1,0)})}}):a.showTip(e.ret.msg)}playerActionEnd(e){this._winUpINDEX=0,this.reloadPlayerMoreZT(!0),e.endActionInfo.forEach((t,i)=>{this._playerArray.forEach(a=>{if(t.userId==a.owner.userId){if(3!=a.owner.actionType){a.changeShowCM(this,2,!0,e.endActionInfo.length,i);let s=t.curXiazhu>0?3:2;a.showMoveCM(this,s,!0,this._moveCMSeat.show,this._moveCMSeat.pi,this._music.moveMangOrPi,e.endActionInfo.length)}3!=a.owner.actionType&&5!=a.owner.actionType&&(a.owner.actionType=-1)}})})}reloadPlayerMoreZT(e=!1){this.setPlayerAutoHandleZT(!1,null),this.setMeHandleBtnZT(!1,null),this._playerArray.forEach(t=>{t.showPlayerCountDown(null,!1),3!=t.owner.actionType&&5!=t.owner.actionType&&t.showActionTip(!1),5==t.owner.actionType&&(e||t.showActionTip(!1))}),this.autoHandleType=null}startAssignPoker(e=!0,t=!1,i){if(e){this.qiaoDealPokerEnd=!1,this.clearQiaoAni(),this.reloadPlayerMoreZT(),i.players.filter(e=>e==this.userId).length>0&&(t||1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(C.instance._music.sub,1),this.showAssignPokerView(e)),this._playerArray.filter(e=>i.players.find(t=>e.owner.isMe&&t==e.owner.userId)).length>0&&p.init(this.delayType.sub,this,i)}else this.showAssignPokerView(e),p.offEvent(this)}assignPokerReturn(e){this._playerArray.forEach(t=>{if(t.owner.userId==e.userId&&(t.showActionTip(!0,6),1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(this._music.subEnd,1),t.owner.isMe)){this.startAssignPoker(!1);let i=[e.poker[0],e.poker[1]],a=[e.poker[2],e.poker[3]],s=n.countPoint(e.poker[0],e.poker[1]),o=n.countPoint(e.poker[2],e.poker[3]);t.showPlayerSubResult(!0,{sub1:{data:i,point:s},sub2:{data:a,point:o}})}})}showAssignPokerView(e,t){this.owner.me_sub_pokerBox.visible=e,this._allowAssignPoker=e,this._confrimSubBtn0.visible=e,this._confrimSubBtn1.visible=!e,this._subPoint1Text.text="",this._subPoint2Text.text="",this._subView1.loadImage(""),this._subView1.pokerName="",this._subView2.loadImage(""),this._subView2.pokerName="",e&&this.setAssignPokerData(),t||(this._subPokerResult=[])}assignPokerCountDown(e=!0,t={}){if(this.allowTimeOutSound=e,this.owner.subCountDown.visible=e,e){this.subAllTime=t.endTime-t.startTime-2;let e=(new Date).getTime()/1e3;this._subCountDownLineTop.x=-this._subCountDownLineTop.width*((e-t.startTime)/this.subAllTime),this._subCountDownVal.text=this.subAllTime+"s",Laya.timer.frameLoop(1,this,this.subCountDownLineMove,[t])}else Laya.timer.clear(this,this.subCountDownLineMove)}subCountDownLineMove(e){let t=(new Date).getTime()/1e3,i=this.subAllTime-parseInt(t-e.startTime);this._subCountDownVal.text=i+"s",this._subCountDownLineTop.x=-this._subCountDownLineTop.width*((t-e.startTime)/this.subAllTime),5==i&&1==a.gameSetVal.gameMusic&&this.allowTimeOutSound&&(this.allowTimeOutSound=!1,Laya.SoundManager.playSound(C.instance._music.subTimeOut,1)),i<=0&&Laya.timer.clear(this,this.subCountDownLineMove)}setAssignPokerData(){this._subView1.pokerName="",this._subView2.pokerName="",this._playerArray.forEach(e=>{if(e.owner.isMe){e.showOrHidePlayerXiuSign(!1),e.showOrHidePlayerShowSign(!1);let t=e.owner.getChildByName("show_me_poker_box")._children;t.forEach((i,a)=>{i.on(Laya.Event.CLICK,this,this.onClickPoker,[i,t,e.owner])})}})}onClickPoker(e,t,i){if(this._allowAssignPoker){let a=t.filter(e=>0==e.scaleX);0==a.length?this.changeSubViewContent(this._subView1,e,t,i):1==a.length&&""===this._subView1.pokerName?this.changeSubViewContent(this._subView1,e,t,i):1==a.length&&""===this._subView2.pokerName&&this.changeSubViewContent(this._subView2,e,t,i),this.changeMePokerX(t,i)}}showPoint(e){let t=e.filter(e=>0==e.scaleX),i=e.filter(e=>0!=e.scaleX);if(2==t.length&&2==i.length){let e=n.countPoint(t[0].pokerName,t[1].pokerName),a=n.countPoint(i[0].pokerName,i[1].pokerName);this._subPoint1Text.text=e,this._subPoint2Text.text=a,this._confrimSubBtn0.visible=!1,this._confrimSubBtn1.visible=!0,this._subPokerResult=[t[0].pokerName,t[1].pokerName,i[0].pokerName,i[1].pokerName],this.$LOG("分牌点击的数据：",t,i)}else this._subPoint1Text.text="",this._subPoint2Text.text="",this._confrimSubBtn1.visible=!1,this._confrimSubBtn0.visible=!0}changeSubViewContent(e,t,i,a){e.loadImage("res/img/poker/"+t.pokerName+".png"),e.pokerName=t.pokerName,t.scaleX=0,e.allowCLICK=!0,e.on(Laya.Event.CLICK,this,this.onClickSubView,[e,i,a]),this.showPoint(i)}onClickSubView(e,t,i){e.allowCLICK&&t.forEach(a=>{a.pokerName==e.pokerName&&(e.loadImage(""),e.pokerName="",a.scaleX=1.3,this.changeMePokerX(t,i),this.showPoint(t))})}changeMePokerX(e,t){let i=e.filter(e=>0!=e.scaleX);3==i.length?i.forEach((e,i)=>{e.x=t.mePokerX_3[i].x}):2==i.length?i.forEach((e,i)=>{e.x=t.mePokerX_2[i].x}):4==i.length&&i.forEach((e,i)=>{e.x=t.mePokerX_4[i].x})}confrimSubResult(){this._subPokerResult&&(this.showAssignPokerView(!1,"view"),this._playerArray.forEach(e=>{e.owner.isMe&&(e.showActionTip(!0,6),e.reloadPlayerPokerZT(!1,[1,2,3,4]))}),w.ERR(this,"点击了确认分牌=====：",this._subPokerResult),this.onSend({name:"M.Games.CX.C2G_AssignPoker",data:{roomId:this.roomId,poker:this._subPokerResult},success(e){this.dealSoketMessage("收到分牌结果:",e)}}))}playerSeatFn(e,t){this._playerArray.forEach(i=>{this[e](t)})}playerWinUp(e){this._winUpINDEX=0,this.allowWinShou=!0,this.reloadPlayerMoreZT(),this.playerSeatFn("assignPokerCountDown",!1),e.players.forEach((t,i)=>{this._playerArray.forEach(i=>{if(t._id==i.owner.userId){if(0!=t.assignPoker.length){this.startAssignPoker(!1),i.reloadPlayerPokerZT(!1,[1,2,3,4]);let e=[t.assignPoker[0],t.assignPoker[1]],a=[t.assignPoker[2],t.assignPoker[3]],s=n.countPoint(t.assignPoker[0],t.assignPoker[1]),o=n.countPoint(t.assignPoker[2],t.assignPoker[3]);i.showPlayerSubResult(!0,{sub1:{data:e,point:s},sub2:{data:a,point:o}})}t.showPoker.length>0&&i.showPlayerXiuView(!0,t.showPoker),setTimeout(()=>{i.showActionTip(!1,null),i.showOrHidePlayerXiaZhuView(!1),i.showMoveCM(this,2,!0,this._moveCMSeat.show,this._moveCMSeat.pi,this._music.moveMangOrPi,1,this.gameEndMoveCMEnd,[e.players])},this._speed.winShowDelay)}})})}gameEndMoveCMEnd(e){if(this._winUpINDEX=0,this.allowWinShou){a.$LOG("移动结束",e);let t=e[0].filter(e=>e.losewin>=0);this.allowWinShou=!1,setTimeout(()=>{e[0].forEach(i=>{this._playerArray.forEach(s=>{if(i._id==s.owner.userId){if(this.showDiChiPi(!1),i.losewin>=0){s.showMoveCM(this,2,!0,this._moveCMSeat.pi,this._moveCMSeat.one,this._music.moveMangOrPi,t.length,function(){a.$LOG("玩家受到金币：",i.score),this.updatePlayerMoreData(e[0])})}if(i.mang>0){let e=this._totalMango-i.mang;e<=0&&this.showDiChiMang(!1),a.$LOG("进来芒:",e),this.bindDiChiMangVal(e)}}})})},this._speed.winCMDelay)}}updatePlayerMoreData(e){e.forEach(e=>{this._playerArray.forEach(t=>{e._id==t.owner.userId&&t.changePlayerScore(e.score,this._changeScoreType.seat),e._id==t.owner.userId&&e.losewin>0&&e._id!=this.userId&&t.playerSeatAddRotationGif(!0),e._id==t.owner.userId&&e.losewin>0&&t.showPlayerLastWinScore(!0,"+"+e.losewin)}),e._id==this.userId&&e.losewin>0&&this.meAnimationZT(!0,a.animations.win,this._music.YouWin)})}recyclingMang(e){this._winUpINDEX=0;let t=0;this._playerArray.forEach(i=>{i.owner.userId==e.userId?(i.showMoveCM(this,1,!0,this._moveCMSeat.mang,this._moveCMSeat.one,this._music.moveMangOrPi,1),this.showDiChiMang(!1)):++t==this._playerArray.length&&this.showDiChiMang(!1)})}roundEnd(){this._playerArray.forEach(e=>{e.reloadPlayerPokerZT(!1,[1,2,3,4]),e.showPlayerSubResult(!1,null),e.showActionTip(!1),e.showPlayerSubResult(!1),e.showOrHidePlayerXiaZhuView(!1),e.showOrHidePlayerXiuSign(!1),e.showPlayerXiuView(!1),e.playerSeatAddRotationGif(!1),e.showPlayerLastWinScore(!1)}),this.meAnimationZT(!1,a.animations.win),this.playerSeatFn("assignPokerCountDown",!1),this.StartAssignPokerArr=[]}playerLiuZuo(e){e.userId==this.userId&&(this.isLiuZuo=!0),this._playerArray.forEach(t=>{t.owner.userId==e.userId&&t.aboutPlayerLiuZuo(e)})}playerSeatAt(e,t){this._playerArray.forEach(t=>{t.owner.seatId==e.seatidx&&(this.keepMeSeatIndex(e,e.seatidx),t.playerSeatDownOrSeatAtCommon(!0,e),t.playerSeatAtSetContent(e))})}playerSeatDown(e,t){this._playerArray.forEach(t=>{t.owner.seatId==e.seatidx&&(t.aboutPlayerLiuZuoEnd(e),this.keepMeSeatIndex(e,e.seatidx),t.playerSeatDownOrSeatAtCommon(!1,e),t.playerSeatDownSetContent(e))})}keepMeSeatIndex(e,t){e.userId==this.userId&&(this._seatIndex=t)}playerSeatUp(e){a.$LOG("玩家起立：",e),e.userId=e.userid,this._playerArray.forEach(t=>{t.owner.userId==e.userid&&(this.keepMeSeatIndex(e,null),t.playerSeatUpSetContent(e),t.showBanker(!1),t.showActionTip(!1,null),t.showOrHidePlayerXiaZhuView(!1),t.aboutPlayerLiuZuoEnd(e),e.userid==this.userId&&t.reloadPlayerPokerZT(!1,[1,2,3,4]))})}openSceneView(e){this.roomId&&a.userInfo.userId&&a.$openScene(e,!1,{userId:a.userInfo.userId,roomId:this.roomId})}setMeMakeBOBO(e){let t=e.param.json[0];this._playerArray.forEach(e=>{t.userId==e.owner.userId&&t.userId==this.userId&&e.setMeMakeBOBO()})}makeUpBoBoConfirmDaiRu(){let e=this.owner.bobo_daiRuScore.text;this.onSend({name:"M.Room.C2R_AddDairu",data:{roomid:this.roomId,idx:this._seatIndex,score:e},success(e){this.dealSoketMessage("补充钵钵：",e)}})}playerAddDairu(e){e.userId==this.userId&&a.showTip("带入成功"),this._playerArray.forEach(t=>{e.userId==t.owner.userId&&t.setAddDaiRuScore(e)})}playerNews(e){this._usableScore=e.score}playerSeatUpSend(){this.onSend({name:"M.Room.C2R_SeatUp",data:{roomid:this.roomId},success(e){a.$LOG("起立请求",e),0==e.ret.type?this.playerSeatUp(e):a.showTip(e.ret.msg)}})}playerLeaveRoomSend(){this.onSend({name:"M.Room.C2R_LeaveRoom",data:{roomid:this.roomId},success(e){this.dealSoketMessage("离开房间：",e)}})}leaveRoomDeal(e){e.userid==this.userId?this.leaveRoomOpenView():this.playerSeatUp(e)}leaveRoomOpenView(){this.onClose(),a.$openScene("tabPage.scene",!0,{page:this.owner._openedData.page})}openDiaLogCommon(e,t,i,a,s){t.visible?setTimeout(()=>{t.visible=e},this.openDiaLogSpeed):t.visible=e,this.owner._mask.alpha=i,"x"==a?Laya.Tween.to(t,{x:s},this.openDiaLogSpeed):Laya.Tween.to(t,{y:s},this.openDiaLogSpeed),this.owner._mask.visible=e}startDealPoker1And2(){this._isUpdateData=!1;let e=this._dealPoker12Array.length;this._dealNumber=0;for(let t=1;t<=2;t++)this._dealPoker12Array.forEach((i,s)=>{this._playerArray.forEach(o=>{if(o.owner.userId==i.uid){let n=t,r=s+(n-1)*e,h=1==n?i.poker[0]:i.poker[1];o.dealPoker(this,n,e,h,r,!1,function(){2==n?(a.$LOG("发首牌结束：",n),this.dealPokerEnd()):this._dealNumber=0})}})})}dealPokerEnd(){this.qiaoDeal34PokerEnd(),this._allowStartAction=!0,this._allowStartAction&&this.startAction()}xiuPoker(e,t){this.onSend({name:"M.Games.CX.C2G_ShowPoker",data:{roomId:this.roomId,poker:e.pokerName,show:t},success(t){if(0==t.ret.type){e.getChildByName("xiuSign").visible=t.show}else a.showTip(t.ret.msg)}})}meAnimationZT(e=!0,t=a.animations.win,i){1==a.gameSetVal.gameMusic&&i&&Laya.SoundManager.playSound(i,1);let s=this.owner.meAnimationBox,o=s.getChildByName("meGIF"+t);if(o&&o.removeSelf(),e){Laya.loader.load("res/atlas/images/GIF/"+t+".atlas",Laya.Handler.create(this,function(){let e=new Laya.Animation;e.name="meGIF"+t,e.pos(s.pivotX,s.pivotY),e.loadAnimation("animation/"+t+".ani"),s.visible=!0,s.addChild(e),e.play()}))}}}var S=new class{open(e){this.getPageNews(e),this.common(!0),this.bindEvent(!0)}common(e){this.showObj=C.instance.owner.PlayerNews_dialog;let t=e?(Laya.stage.height-this.showObj.height)/2:-this.showObj.height;C.instance.openDiaLogCommon(e,this.showObj,0,"y",t)}close(){this.common(!1),this.bindEvent(!1)}bindEvent(e){let t=C.instance.owner._mask;e?t.on(Laya.Event.CLICK,this,this.close):t.off(Laya.Event.CLICK)}getPageNews(e){c.$request({that:this,url:"/M.Games.CX/GetSeatUserInfo",data:{uid:a.userInfo.userId,tuid:e.userId,roomid:C.instance.roomId},success(e){a.$LOG("获取的玩家个人信息",e),0==e.data.ret.type?this.setPage(e.data):a.showTip(e.data.ret.msg)},fail(){}})}setPage(e){let t=this.showObj.getChildByName("news_head_box").getChildByName("headBg").getChildByName("head"),i=this.showObj.getChildByName("news_box").getChildByName("news_name"),s=i.getChildByName("news_sex").getChildByName("sex0"),o=i.getChildByName("news_sex").getChildByName("sex1"),n=this.showObj.getChildByName("news_box").getChildByName("news_ID").getChildByName("news_ID_value"),r=this.showObj.getChildByName("news_alljs").getChildByName("news_alljs_value"),h=this.showObj.getChildByName("news_fanpairate").getChildByName("news_fanpairate_value"),l=this.showObj.getChildByName("news_allss").getChildByName("news_allss_value"),d=this.showObj.getChildByName("news_fanpaiwinrate").getChildByName("news_fanpaiwinrate_value"),c=this.showObj.getChildByName("news_winss").getChildByName("news_winss_value"),g=this.showObj.getChildByName("news_allwinrate").getChildByName("news_allwinrate_value"),m="res/img/head/"+e.head+".png";a.$LoadImage(t,m,a.defaultImg.one,"skin"),i.text=e.name,i.getChildByName("news_sex").left=i.textWidth,s.visible=0==e.sex,o.visible=1==e.sex,n.text=e.userId,r.text=e.totalJs;let p=e.totalSs>0?e.totalSs:1;h.text=parseInt(e.fpSs/p*100)+"%",l.text=e.totalSs;let y=e.fpSs>0?e.fpSs:1;d.text=parseInt(e.fpWinSs/y*100)+"%",c.text=e.winSs,g.text=100*parseInt(e.winSs/p)+"%"}};var L=new class{initGameSet(e){this.GameUI=e,this.GameControl=C.instance,this.setGameView(),this.getGameSetVal()}open(){this.common(!0),this.bindEvent(!0),this.setSwitch(),this.gameSetRegisterEvent()}common(e){let t=C.instance.owner.gameSet_dialog,i=e?(Laya.stage.height-t.height)/2:-t.height;C.instance.openDiaLogCommon(e,t,0,"y",i)}close(){this.common(!1),this.bindEvent(!1),this.gameSetRegisterEventOff()}bindEvent(e){let t=C.instance.owner._mask;e?t.on(Laya.Event.CLICK,this,this.close):t.off(Laya.Event.CLICK)}setGameView(){let e=localStorage.getItem("deskView")?localStorage.getItem("deskView"):"desk_bg1";a.$LoadImage(this.GameUI.deskBg,a.gameView[e],a.gameView.desk_bg1,"skin"),this.GameUI.gameSet_deskViewBox._children.forEach(t=>{t.getChildByName("desk").getChildByName("selectSign").visible=!1,t.name==e&&(t.getChildByName("desk").getChildByName("selectSign").visible=!0)})}gameSetRegisterEvent(){this.GameUI.gameSet_deskViewBox._children.forEach(e=>{e.on(Laya.Event.CLICK,this,this.onClickThisDeskView,[e])})}gameSetRegisterEventOff(){this.GameUI.gameSet_deskViewBox._children.forEach(e=>{e.off(Laya.Event.CLICK)}),C.instance.owner.game_music_switchBox.off(Laya.Event.CLICK),C.instance.owner.game_chat_switchBox.off(Laya.Event.CLICK)}onClickThisDeskView(e){localStorage.setItem("deskView",e.name),this.setGameView()}setSwitch(){this.getGameSetVal();let e=this.GameUI.game_music_switchBox,t=this.GameUI.game_chat_switchBox;a.$switch(e,a.gameSetVal.gameMusic,this,e=>{let t=e?1:0;localStorage.setItem("gameMusic",t)}),a.$switch(t,a.gameSetVal.chatVoice,this,e=>{let t=e?1:2;localStorage.setItem("chatVoice",t),a.chatVoiceOpenState=!localStorage.getItem("chatVoice")||1==localStorage.getItem("chatVoice")})}getGameSetVal(){a.gameSetVal={gameMusic:localStorage.getItem("gameMusic")?localStorage.getItem("gameMusic"):1,chatVoice:localStorage.getItem("chatVoice")?localStorage.getItem("chatVoice"):1,pangGuanchat:localStorage.getItem("pangGuanchat")?localStorage.getItem("pangGuanchat"):1}}};class b extends Laya.Script{constructor(){super()}onEnable(){this.bindEvent(),this.init()}bindEvent(){this.list=this.owner.getChildByName("selectList"),this.list.cells.forEach(e=>{let t=e.getChildByName("listRow").getChildByName("select");t.on(Laya.Event.CLICK,this,this.clickSelectBox,[t,e])})}clearAllSelect(){this.list.cells.forEach(e=>{e.getChildByName("listRow").getChildByName("select").getChildByName("yes").visible=!1})}clickSelectBox(e,t){this.clearAllSelect();let i=e.getChildByName("yes");i.visible=!i.visible,this.returnFn&&this.returnFn.call(this.fnThat,t.dataSource.value)}init(e=0){this.clearAllSelect(),this.list.cells.forEach((t,i)=>{if(i==e){t.getChildByName("listRow").getChildByName("select").getChildByName("yes").visible=!0}})}MySelect(e,t=0,i){this.fnThat=e,this.returnFn=i,this.init(t)}}var x=new class{constructor(){this.selectIndex=0,this.chatDialog=null,this.voiceChatView=null,this.expressionChatView=null}getView(){this.chatDialog=C.instance.owner.chat_dialog,this.voiceChatView=this.chatDialog.getChildByName("voiceChatView"),this.expressionChatView=this.chatDialog.getChildByName("expressionChatView")}open(){this.MeSeatArr=C.instance._playerArray.filter(e=>e.owner.isMe),this.MeSeatArr.length>0?(this.getView(),this.common(!0),this.bindEvent(!0),this.initSelect(),this.initSelectJS(),this.initVoiceChatView(),this.initExpressionChatView()):a.showTip("旁观者不能聊天!")}bindEvent(e){let t=C.instance.owner._mask;e?t.on(Laya.Event.CLICK,this,this.close):t.off(Laya.Event.CLICK)}common(e){let t=this.chatDialog,i=e?Laya.stage.height-t.height:Laya.stage.height;C.instance.openDiaLogCommon(e,t,0,"y",i)}close(){this.bindEvent(!1),this.common(!1)}initSelect(){let e=this.chatDialog.getChildByName("selectView").getChildByName("selectList");e.array=[{icon:"res/img/common/chat_icon1.png",value:0},{icon:"res/img/common/chat_icon2.png",value:1}],e.renderHandler=new Laya.Handler(this,this.selectListRender)}selectListRender(e){e.getChildByName("listRow").getChildByName("select").getChildByName("no").loadImage(e.dataSource.icon)}initSelectJS(){this.selectedShowView(),this.chatDialog.getChildByName("selectView").getComponent(b).MySelect(this,this.selectIndex,e=>{this.selectIndex=e,this.selectedShowView()})}selectedShowView(){this.voiceChatView.visible=0==this.selectIndex,this.expressionChatView.visible=1==this.selectIndex}initVoiceChatView(){let e=this.voiceChatView.getChildByName("voiceList");e.array=a.chatVoice,e.vScrollBarSkin="",e.visible=!0,e.renderHandler=new Laya.Handler(this,this.voiceListRender),e.mouseHandler=new Laya.Handler(this,this.clickListRow)}voiceListRender(e,t){t==a.chatVoice.length-1&&e.getChildByName("line")&&e.getChildByName("line").removeSelf(),e.getChildByName("text").text=e.dataSource.text}clickListRow(e,t){if("click"==e.type){this.close();let t=e.target.dataSource.id,i=e.target.dataSource.text;C.instance.onSend({name:"M.Games.CX.C2G_GameChat",data:{chat:{recipient:-1,sender:C.instance.userId,content:i,msgType:1,msgId:t},roomId:parseInt(C.instance.roomId),chatType:0},success(e){C.instance.dealSoketMessage("发送快捷语音：",e)}})}}openSeatChatView(e,t){let i=e.owner.getChildByName("fastChatBox"),s=i.getChildByName("text");i.visible=!0,s.text=t.content;let o=a.chatVoiceOpenState?1:0;e.soundUrl=a.chatVoice[t.msgId].voice+(new Date).getTime();let n=(new Date).getTime();e["chatVoice"+n]=Laya.SoundManager.playSound(a.chatVoice[t.msgId].voice,1,Laya.Handler.create(this,()=>{e["chatVoice"+n].soundUrl==e.soundUrl&&(i.visible=!1,s.text="")})),e["chatVoice"+n]?(e["chatVoice"+n].soundUrl=a.chatVoice[t.msgId].voice+n,e["chatVoice"+n].volume=o):(i.visible=!1,s.text="")}initExpressionChatView(){let e=this.expressionChatView.getChildByName("expressionList");e.array=a.expressionChat,e.vScrollBarSkin="",e.visible=!0,e.renderHandler=new Laya.Handler(this,this.expressionListRender),e.mouseHandler=new Laya.Handler(this,this.clickExpressionList)}expressionListRender(e){e.getChildByName("icon").loadImage(e.dataSource.icon)}clickExpressionList(e){if("click"==e.type){this.close();let t=e.target.dataSource.id;C.instance.onSend({name:"M.Games.CX.C2G_GameChat",data:{chat:{recipient:-1,sender:C.instance.userId,content:String(t),msgType:2,msgId:1},roomId:parseInt(C.instance.roomId),chatType:0},success(e){C.instance.dealSoketMessage("发送表情：",e)}})}}};var v=new class{constructor(){this.selectNum=150}open(e){this.MeSeatArr=C.instance._playerArray.filter(e=>e.owner.isMe),this.MeSeatArr.length>0?C.instance.isLiuZuo?a.showTip("您当前已留座，不能再留座了!"):(this.common(!0),this.bindEvent(!0),this.init()):a.showTip("您当前为观战模式，无法留座!")}common(e){let t=C.instance.owner.LiuZuo_dialog,i=e?(Laya.stage.height-t.height)/2:Laya.stage.height;C.instance.openDiaLogCommon(e,t,0,"y",i)}close(){this.bindEvent(!1),this.common(!1)}bindEvent(e){let t=C.instance.owner._mask;e?t.on(Laya.Event.CLICK,this,this.close):t.off(Laya.Event.CLICK)}confrim(){C.instance.owner.LiuZuo_dialog.getChildByName("confrimBtn").on(Laya.Event.CLICK,this,this.confrimLiuZuo)}closeBtnEvent(){C.instance.owner.LiuZuo_dialog.getChildByName("close").on(Laya.Event.CLICK,this,this.close)}init(){this.confrim(),this.returnSeat(),this.selectTime(),this.setPageData(),this.closeBtnEvent()}setPageData(){this.selectListBox=C.instance.owner.LiuZuo_dialog.getChildByName("selectListBox");let e=this.selectListBox.getChildByName("selectList");e.visible=!0,e.array=[{img:"res/img/LiuZuo/120.png",value:150},{img:"res/img/LiuZuo/300.png",value:300}],e.renderHandler=new Laya.Handler(this,this.listRenderHandler)}listRenderHandler(e){e.getChildByName("listRow").getChildByName("label").skin=e.dataSource.img}selectTime(){C.instance.owner.LiuZuo_dialog.getChildByName("selectListBox").getComponent(b).MySelect(this,0,e=>{this.selectNum=e})}confrimLiuZuo(){this.close(),this.request(!0)}request(e){C.instance.onSend({name:"M.Room.C2R_Reservation",data:{roomid:C.instance.roomId,reservation:e,consume:this.selectNum},success(e){C.instance.dealSoketMessage("留座：",e)}})}returnSeat(){C.instance.owner.returnSeatBtn.on(Laya.Event.CLICK,this,this.request,[!1])}start(e,t){this.returnSeat(),this.playerLiuZuoDealContent(e,t)}playerLiuZuoDealContent(e,t){e.liuzuoAllTime=t.seatAtTime-a.getTimeChuo(),e.liuzuoAllTime=e.liuzuoAllTime>t.totalTime?t.totalTime:e.liuzuoAllTime;let i=e.owner.getChildByName("liuzuoSign"),s=C.instance.owner.returnSeatBtn;i.visible=!0,t.userId==C.instance.userId&&(s.visible=!0);let o=e.owner.getChildByName("score")._children[0].getChildByName("scoreVal");o.text="留座"+e.liuzuoAllTime+"s",Laya.timer.loop(1e3,e,e.palyerLiuZuoTime,[o])}time(e,t){e.liuzuoAllTime--,t.text="留座"+e.liuzuoAllTime+"s",e.liuzuoAllTime<=0&&Laya.timer.clear(e,e.palyerLiuZuoTime)}end(e,t){Laya.timer.clear(e,e.palyerLiuZuoTime);let i=e.owner.getChildByName("liuzuoSign"),a=C.instance.owner.returnSeatBtn;i.visible=!1,t.userId==C.instance.userId&&(a.visible=!1)}};var B=new class{open(e=!0){this.MeSeatArr=C.instance._playerArray.filter(e=>e.owner.isMe),this.MeSeatArr.length>0?(this.getPlayerUsableScore(e=>{this.setBOBO()}),this.common(!0)):a.showTip("您当前为观战模式,无法添加钵钵!"),e?this.bindEvent(!0):this.bindEvent(!1)}bindEvent(e){C.instance.owner.bobo_close.on(Laya.Event.CLICK,this,this.close,[e]),C.instance.owner._mask.on(Laya.Event.CLICK,this,this.close,[e])}common(e){let t=C.instance.owner.makeUp_bobo,i=e?(Laya.stage.height-t.height)/2:-t.height;C.instance.openDiaLogCommon(e,t,0,"y",i)}close(e=!1){C.instance.owner.makeUp_bobo.visible&&(this.common(!1),e&&C.instance.playerSeatUpSend())}getPlayerUsableScore(e){let t=this;c.$request({that:this,url:"/M.User/GetInfo",data:{uid:a.userInfo.userId,tuid:a.userInfo.userId},success(i){if(0==i.data.ret.type){t._usableScore=i.data.score;let a={score:i.data.score};e.call(t,a)}else a.showTip(i.data.ret.msg)},fail(){}})}setBOBO(){let e=C.instance;e.owner.bobo_daiRuScore.text=e._gameRoomeNews.dairu,e.owner.bobo_ID.text=e.userId,e.owner.bobo_fuwufei.text=.1*e.owner.bobo_daiRuScore.text,e.owner.bobo_trueScore.text=this._usableScore;let t=e.owner.makeUp_bobo.getChildByName("sliderView"),i=t.getChildByName("slider_btn"),s=t.width/5;a.$slider(t,i,e,t=>{t>=0&&t<1*s?e.owner.bobo_daiRuScore.text=1*e._gameRoomeNews.dairu:t>=1*s&&t<2*s?e.owner.bobo_daiRuScore.text=2*e._gameRoomeNews.dairu:t>=2*s&&t<3*s?e.owner.bobo_daiRuScore.text=3*e._gameRoomeNews.dairu:t>=3*s&&t<4*s?e.owner.bobo_daiRuScore.text=4*e._gameRoomeNews.dairu:t>=4*s&&t<5*s?e.owner.bobo_daiRuScore.text=5*e._gameRoomeNews.dairu:t==5*s&&(e.owner.bobo_daiRuScore.text=6*e._gameRoomeNews.dairu),e.owner.bobo_fuwufei.text=.1*e.owner.bobo_daiRuScore.text})}};var f=new class{open(){this.common(!0),this.bindEvent(!0),this.initPage()}close(){this.common(!1),this.bindEvent(!1)}common(e){let t=C.instance.owner.menu,i=e?0+a.phoneNews.statusHeight:-t.height;C.instance.openDiaLogCommon(e,t,.2,"y",i)}bindEvent(e=!0){let t=C.instance.owner._mask;e?t.on(Laya.Event.CLICK,this,this.close):t.off(Laya.Event.CLICK)}initPage(){let e=C.instance.owner.menu.getChildByName("menuList");e.array=[{id:1,imgUrl:"res/img/menu/menu_1.png"},{id:2,imgUrl:"res/img/menu/menu_2.png"},{id:3,imgUrl:"res/img/menu/menu_3.png"},{id:4,imgUrl:"res/img/menu/menu_4.png"},{id:5,imgUrl:"res/img/menu/menu_5.png"},{id:6,imgUrl:"res/img/menu/menu_6.png"},{id:7,imgUrl:"res/img/menu/menu_7.png"}],e.renderHandler=new Laya.Handler(this,this.menuOnRender),e.mouseHandler=new Laya.Handler(this,this.menuOnClick)}menuOnRender(e,t){if(e.getChildByName("menu_row_node").getChildByName("listContent").skin=e.dataSource.imgUrl,7==e.dataSource.id){let t=e.getChildByName("menu_row_node").getChildByName("line");t&&t.removeSelf()}}menuOnClick(e,t){if("click"==e.type){let t=e.target.dataSource.id;this.close(),2==t?Laya.Scene.open("paijutishi.scene",!1,{show:!0}):1==t?C.instance.playerSeatUpSend():7==t?C.instance.playerLeaveRoomSend():4==t?B.open(!1):3==t?L.open(!0):5==t?v.open(this):6==t&&a.$openScene("shoppingMall.scene",!1,{isTabPage:!1},e=>{e.zOrder=30,e.x=Laya.stage.width,Laya.Tween.to(e,{x:0},a._speed.page)})}}};class I extends Laya.Scene{constructor(){super(),I.instance=this,this.ceshiNum=0,this.ceshiNum2=0}onAwake(){}onOpened(e){this.zOrder=9,this.width=Laya.stage.width,this.height=Laya.stage.height,this._openedData=e,a.$LOG("打开游戏界面接受到的参数：",this._openedData),L.initGameSet(this),this.setUISite()}setUISite(){this.TOPHandleBtnBox.top=a.phoneNews.statusHeight}tipMoveEnd(e){Laya.Tween.to(e,{alpha:0},300,null,Laya.Handler.create(this,this.tipAlphaEnd,[e]))}tipAlphaEnd(e){e.removeSelf()}onAwake(){a.$LOG("GameUI：",this)}onEnable(){this._confirmDaiRuBtn=this.makeUp_bobo.getChildByName("confirmDaiRuBtn"),this._control=this.getComponent(C),this.confrimSubBtn1.on(Laya.Event.CLICK,this,this.onClickConfrimSubBtn1),this._mask.on(Laya.Event.CLICK,this,this.onClickMask),this.menuBtnUI.on(Laya.Event.CLICK,this,this.onClickMenuBtn),this.nowPaiJuUI.on(Laya.Event.CLICK,this,this.onClickNowPaiJuBtn),this.paiJuHuiGuBtnUI.on(Laya.Event.CLICK,this,this.onClickPaijuhuiguBtn),this.errReloadBtnUI.on(Laya.Event.CLICK,this,this.onClickErrReloadBtn),this._confirmDaiRuBtn.on(Laya.Event.CLICK,this,this.onClickConfirmDaiRuBtn),this.gameSet_close.on(Laya.Event.CLICK,this,this.onClickMask),this.chatBtnUI.on(Laya.Event.CLICK,this,this.onClickChatBtn),this.ceshiEvent()}onClickErrReloadBtn(){C.instance.onClose(),C.instance.onConnect(),a.showTip("正在刷新数据，请稍后...")}ceshiEvent(){this.ceshi_show_view_btn.on(Laya.Event.CLICK,this,this.click_ceshi_btn),this.ceshi_LOG.on(Laya.Event.CLICK,this,this.ceshiContent,[1]),this.ceshi_ERRROLAD.on(Laya.Event.CLICK,this,this.ceshiContent,[2])}click_ceshi_btn(){this.ceshiNum++,5==this.ceshiNum?(this.ceshi_view.visible=!0,Laya.Tween.to(this.ceshi_view,{x:20,alpha:1},200),this.ceshiNum=-1):Laya.Tween.to(this.ceshi_view,{x:-200,alpha:0},100,null,Laya.Handler.create(this,()=>{this.ceshi_view.visible=!1}))}ceshiContent(e){1==e?(this.ceshiNum2++,this.ceshiNum2%2==0?this.ceshi_log_list.visible=!1:this.ceshi_log_list.visible=!0):2==e&&(C.instance.onClose(),C.instance.onConnect(),a.showTip("正在刷新数据，请稍后..."))}onClickVoiceBtn(){this._control.ceShi()}onClickConfrimSubBtn1(){this._control.confrimSubResult()}onClickChatBtn(){x.open(this)}onClickConfirmDaiRuBtn(){this._control.makeUpBoBoConfirmDaiRu()}onClickMenuBtn(){f.open()}onClickNowPaiJuBtn(){this._control.openSceneView("shishizhanji.scene")}onClickPaijuhuiguBtn(){this._control.openSceneView("paijuhuigu.scene")}}let k=0;class N extends Laya.Script{constructor(){super(),this._mask=new Laya.Sprite}onEnable(){this.jionNum=0,this._showSubBox=!1,N.instance=this,this._userId="",this._isMe=!1}onDisable(){}onStart(){l.send("seat",this),this.owner.on(Laya.Event.CLICK,this,this.mouseHandler)}mouseHandler(e){""==e.target.userId&&C.instance.onSend({name:"M.Room.C2R_SeatAt",data:{roomid:C.instance.roomId,idx:e.target.seatId},success(t){if(C.instance.dealSoketMessage("占位：",t),0==t.ret.type){let t=e.target.index;C.instance.changeSeatXY(t,C.instance._speed.changeSeatSpeed)}}})}playerSeatAtSetContent(e){this.owner.curXiaZhuScore=0,this.lastTime=e.seatAtTime-a.getTimeChuo(),this.lastTime>e.totalTime&&(this.lastTime=e.totalTime);let t=this.owner.getChildByName("score");t.visible=!0;let i=t._children[0].getChildByName("scoreVal");i.text="等待"+this.lastTime+"s",Laya.timer.loop(1e3,this,this.palyerSeatAtTime,[i])}palyerSeatAtTime(e){this.lastTime--,e.text="等待"+this.lastTime+"s",this.lastTime<=0&&Laya.timer.clear(this,this.palyerSeatAtTime)}aboutPlayerLiuZuo(e){v.start(this,e)}aboutPlayerLiuZuoEnd(e){v.end(this,e)}palyerLiuZuoTime(e){v.time(this,e)}playerSeatDownSetContent(e){this.playerSeatDownRegisterEvent(),this.owner.timeID&&clearInterval(this.owner.timeID);let t=this.owner.getChildByName("score"),i=t._children[0].getChildByName("scoreVal");t.visible=!0,i.text=e.score}playerSeatDownRegisterEvent(){this.playerSeatUpOffEvent(),this.owner.getChildByName("head-box").on(Laya.Event.CLICK,this,this.getPlayerNews)}playerSeatUpOffEvent(){this.owner.getChildByName("head-box").off(Laya.Event.CLICK)}getPlayerNews(){let e={userId:this.owner.userId};S.open(e)}setMeMakeBOBO(){B.close()}playerSeatDownOrSeatAtCommon(e,t,i){this.playerSeatDownRegisterEvent(),Laya.timer.clear(this,this.palyerSeatAtTime);let s=this.owner.getChildByName("head-box"),o=s.getChildByName("headBg").getChildByName("head"),n=this.owner.getChildByName("name");s.visible=!0;let r="res/img/head/"+t.head+".png";a.$LoadImage(o,r,a.defaultImg.one,"skin"),this.owner.userId=t.userId,t.userId==C.instance.userId?(n.text="",this.owner.isMe=!0,e?B.open(!0):B.close()):(n.text=t.name,this.owner.isMe=!1)}playerSeatUpSetContent(e){this.playerSeatUpOffEvent();let t=this.owner.getChildByName("head-box"),i=t.getChildByName("headBg").getChildByName("head"),a=this.owner.getChildByName("score"),s=a._children[0].getChildByName("scoreVal"),o=this.owner.getChildByName("name");t.visible=!1,a.visible=!1,i.skin="",s.text="",this.owner.userId="",e.userid==C.instance.userId?(this.owner.isMe=!1,B.close()):o.text=""}setAddDaiRuScore(e){Laya.timer.clear(this,this.palyerSeatAtTime),this.owner.getChildByName("score")._children[0].getChildByName("scoreVal").text=e.score}showOrHideMePokerSeat(){this.owner.getChildByName("show_poker_box").visible=!this.owner.isMe;let e=this.owner.parent._children.filter(e=>e.isMe);I.instance.show_me_poker_box.visible=0!=e.length}showPlayerCountDown(e,t=!0){let i=this.owner.getChildByName("countDownBox");i.visible=t,t?(this._allTime=e.endTime-e.startTime-2,this._rotation=((new Date).getTime()/1e3-e.startTime)/this._allTime*360,this._timeOutFlag=!0,this._showTimePlayerObj=this.owner,this._imgNode=i.getChildByName("countDown"),this._imgNode.loadImage("res/img/gameView/progress1.png",Laya.Handler.create(this,this.loadImgEnd,[e])),this._countDownText=this.owner.getChildByName("countDownBox").getChildByName("timeText")):Laya.timer.clear(this,this.drawPie)}loadImgEnd(e){Laya.timer.frameLoop(1,this,this.drawPie,[e])}drawPie(e){this._countDownText.text=this._allTime-parseInt((new Date).getTime()/1e3-e.startTime)+"s",this._allTime-parseInt((new Date).getTime()/1e3-e.startTime)==5&&this._showTimePlayerObj.isMe&&this._timeOutFlag&&(this._timeOutFlag=!1,1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(C.instance._music.subTimeOut,1),this._imgNode.loadImage("res/img/gameView/progress2.png")),this._rotation=((new Date).getTime()/1e3-e.startTime)/this._allTime*360,this._rotation>=360&&(this._rotation=360,Laya.timer.clear(this,this.drawPie)),this._mask.graphics.clear(),this._mask.graphics.drawPie(83,83,83,this._rotation,360,"#000000"),this._imgNode.mask=this._mask}changeShowCM(e,t,i=!0,a,s,o){let n=this.owner.getChildByName("xiaZhuScore");n.visible=i,n.getChildByName("cm_show_seat").loadImage("res/img/gameView/choumaBg"+t+".png",Laya.Handler.create(this,function(e,t){s+1==t&&o&&o.call(e)},[e,a]))}showOrHidePlayerXiuSign(e=!0){if(this.owner.isMe){let t=this.owner.getChildByName("show_me_poker_box"),i=t.getChildByName("poker1").getChildByName("xiuSign"),a=t.getChildByName("poker2").getChildByName("xiuSign");i.visible=e,a.visible=e}}showOrHidePlayerShowSign(e=!0){if(this.owner.isMe){let t=this.owner.getChildByName("show_me_poker_box"),i=t.getChildByName("poker3").getChildByName("showSign"),a=t.getChildByName("poker4").getChildByName("showSign");i.visible=e,a.visible=e,e||(C.instance._allowXiuPoker=!1)}}bindPlayerXiaZhuScoreVal(e,t){let i=this.owner.getChildByName("xiaZhuScore").getChildByName("scoreVal");i.text=t==C.instance._betType.mang==t?e.mango:e.pi,this.owner.curXiaZhuScore=i.text}changePlayerScore(e,t){if(C.instance._changeScoreType.seat==t){this.owner.getChildByName("score").getChildByName("scoreVal").text=e}else if(C.instance._changeScoreType.xiaZhu==t){let t=this.owner.getChildByName("xiaZhuScore").getChildByName("scoreVal");t.text=e,this.owner.curXiaZhuScore=t.text}}showOrHidePlayerXiaZhuView(e){this.owner.getChildByName("xiaZhuScore").visible=e}showMoveCM(e,t,i=!0,a,s,o,n,r,h){let l=this.owner.getChildByName("create_cm_seat").getChildByName("move_cm");switch(l.visible=i,a){case C.instance._moveCMSeat.one:l.pos(0,0);break;case C.instance._moveCMSeat.show:l.pos(this.owner._showCMFaceToPlayerXY.x,this.owner._showCMFaceToPlayerXY.y);break;case C.instance._moveCMSeat.mang:l.pos(this.owner._mangDiChiFaceToPlayerXY.x,this.owner._mangDiChiFaceToPlayerXY.y);break;case C.instance._moveCMSeat.pi:l.pos(this.owner._piDiChiFaceToPlayerXY.x,this.owner._piDiChiFaceToPlayerXY.y)}l.loadImage("res/img/gameView/choumaBg"+t+".png",Laya.Handler.create(this,this.moveShowCM,[e,l,s,o,n,r,h]))}moveShowCM(e,t,i,s,o,n,r){let h=C.instance._speed.moveCM;switch(i){case C.instance._moveCMSeat.one:Laya.Tween.to(t,{x:0,y:0},h,null,Laya.Handler.create(this,moveEnd,[e,t,n]));break;case C.instance._moveCMSeat.show:Laya.Tween.to(t,{x:this.owner._showCMFaceToPlayerXY.x,y:this.owner._showCMFaceToPlayerXY.y},h,null,Laya.Handler.create(this,moveEnd,[e,t,n]));break;case C.instance._moveCMSeat.mang:Laya.Tween.to(t,{x:this.owner._mangDiChiFaceToPlayerXY.x,y:this.owner._mangDiChiFaceToPlayerXY.y},h,null,Laya.Handler.create(this,moveEnd,[e,t,n]));break;case C.instance._moveCMSeat.pi:Laya.Tween.to(t,{x:this.owner._piDiChiFaceToPlayerXY.x,y:this.owner._piDiChiFaceToPlayerXY.y},h,null,Laya.Handler.create(this,moveEnd,[e,t,n]))}function moveEnd(e,t,i){t.visible=!1,C.instance._winUpINDEX++,C.instance._winUpINDEX==o&&(1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(s,1),i&&i.call(e,r))}}reloadPlayerPokerZT(e,t){if(4==t.length){this.owner.getChildByName("show_me_poker_box")._children.forEach(t=>{t.visible=e})}let i=t.filter(e=>1==e||2==e),a=t.filter(e=>3==e||4==e);i.forEach(t=>{this.owner.getChildByName("deal_cards_seat").getChildByName("poker"+t).visible=e}),a.forEach(t=>{this.owner.getChildByName("deal_cards_seat34").getChildByName("poker"+t).visible=e})}onclickPoker12Show(e){C.instance._allowXiuPoker&&(e.isShow=!e.isShow,C.instance.xiuPoker(e,e.isShow))}showPlayerXiuSign(e){let t=this.owner.getChildByName("show_me_poker_box"),i=t.getChildByName("poker1"),a=t.getChildByName("poker2"),s=e.filter(e=>e==i.pokerName),o=e.filter(e=>e==a.pokerName),n=i.getChildByName("xiuSign"),r=a.getChildByName("xiuSign");n.visible=s.length>0,r.visible=o.length>0,i.isShow=n.visible,a.isShow=r.visible}dealPoker(e,t,i,a,s,o,n){if(w.ERR(e,"this.owner.isMe:",this.owner.isMe),this.owner.isMe){let r=this.owner.getChildByName("show_me_poker_box"),h=r.getChildByName("poker"+t);h.visible=!0,h.alpha=0,h.scaleX=1,h.scaleY=1,h.rotation=180,h.pokerName=a;let l=r.globalToLocal(new Laya.Point(Laya.stage.width/2,Laya.stage.height/2));if(h.pos(l.x,l.y),h.loadImage("res/img/poker/-1.png",Laya.Handler.create(this,this.loadDealMePokerEnd,[e,h,t,i,a,s,o,n])),t<=2){let e=this.owner.getChildByName("deal_cards_seat"),i=e.getChildByName("poker"+t);e.x=this.owner._diuPokerSeatXY.x,e.y=this.owner._diuPokerSeatXY.y,e.rotation=0,i.visible=!0,i.alpha=0,i.x=1==t?0:20,i.y=0,i.rotation=1==t?-10:10,i.scaleX=.5,i.scaleY=.5,h.isShow=!1,h.getChildByName("xiuSign").visible=!1,h.on(Laya.Event.CLICK,this,this.onclickPoker12Show,[h])}else h.getChildByName("showSign").visible=!1}if(!this.owner.isMe){let r=this.owner.getChildByName("deal_cards_seat");r.rotation=0,r.x=this.owner._diuPokerSeatXY.x,r.y=this.owner._diuPokerSeatXY.y,t>=3&&(r=this.owner.getChildByName("deal_cards_seat34"));let h=r.getChildByName("poker"+t),l=r.globalToLocal(new Laya.Point(Laya.stage.width/2,Laya.stage.height/2));h.visible=!0,h.alpha=0,h.scaleX=1,h.scaleY=1,h.rotation=180,h.pos(l.x,l.y),h.loadImage("res/img/poker/-1.png",Laya.Handler.create(this,this.loadDealPokerEnd,[e,h,t,i,a,s,o,n]))}}loadDealMePokerEnd(e,t,i,s,o,n,r,h){let l=r?0:n*(C.instance._speed.moveCard/(parseInt(s/2)<1?1:parseInt(s/2)));a.$LOG("等待时间：",l);let d=r?0:1;Laya.Tween.to(t,{alpha:d},0,null,Laya.Handler.create(this,this.changeMePokerAlphaEnd,[e,t,i,s,o,n,r,h]),l)}loadDealPokerEnd(e,t,i,s,o,n,r,h){let l=r?0:n*(C.instance._speed.moveCard/(parseInt(s/2)<1?1:parseInt(s/2)));a.$LOG("等待时间：",l);let d=r?0:1;Laya.Tween.to(t,{alpha:d},0,null,Laya.Handler.create(this,this.changePokerAlphaEnd,[e,t,i,s,o,n,r,h]),l)}changeMePokerAlphaEnd(e,t,i,s,o,n,r,h){let l=1.3*t.width*i+1.3*t.pivotX,d=1.3*t.pivotY;if(i<=2&&this.owner.mePokerX_2.push({x:l}),3==i){let e=this.owner.getChildByName("show_me_poker_box").getChildByName("poker1"),a=this.owner.getChildByName("show_me_poker_box").getChildByName("poker2"),s=1.3*t.width*1+1.3*t.pivotX-e.width/2*1.3,o=1.3*t.width*2+1.3*t.pivotX-a.width/2*1.3;Laya.Tween.to(e,{x:s},100),Laya.Tween.to(a,{x:o},100),l=1.3*t.width*i+1.3*t.pivotX-e.width/2*1.3,this.owner.mePokerX_3=[{x:s},{x:o},{x:l}]}else if(4==i){let e=this.owner.getChildByName("show_me_poker_box").getChildByName("poker1"),i=this.owner.getChildByName("show_me_poker_box").getChildByName("poker2"),a=this.owner.getChildByName("show_me_poker_box").getChildByName("poker3"),s=1.3*t.width*0+1.3*t.pivotX,o=1.3*t.width*1+1.3*t.pivotX,n=1.3*t.width*2+1.3*t.pivotX;Laya.Tween.to(e,{x:s},100),Laya.Tween.to(i,{x:o},100),Laya.Tween.to(a,{x:n},100),l=1.3*t.width*3+1.3*t.pivotX,this.owner.mePokerX_4=[{x:s},{x:o},{x:n},{x:l}]}let c=r?0:C.instance._speed.moveCard;r||1==a.gameSetVal.gameMusic&&(C.instance.$LOG("进来音效"),Laya.SoundManager.playSound(C.instance._music.dealCards,1)),Laya.Tween.to(t,{x:l,y:d,scaleX:1.3,scaleY:1.3,rotation:0},c,null,Laya.Handler.create(this,this.moveMeCardEnd,[e,t,i,s,o,n,r,h]))}changePokerAlphaEnd(e,t,i,s,o,n,r,h){if(i<=2){let o=1==i?0:20,l=1==i?-10:10,d=r?0:C.instance._speed.moveCard;r||1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(C.instance._music.dealCards,1),Laya.Tween.to(t,{x:o,y:0,scaleX:.5,scaleY:.5,rotation:l},d,null,Laya.Handler.create(this,this.moveCardEnd,[e,t,s,n,r,h]))}else{let l=this.owner.getChildByName("show_poker_box").getChildByName("poker_box").globalToLocal(new Laya.Point(Laya.stage.width/2,Laya.stage.height/2)),d=this.owner.getChildByName("deal_cards_seat34").globalToLocal(new Laya.Point(Laya.stage.width/2,Laya.stage.height/2)),c=d.x-l.x+.9*t.pivotX,g=d.y-l.y+.9*t.pivotY;if(4==i){c+=t.width/4;let e=d.x-l.x+.9*t.pivotX-t.width/4,i=this.owner.getChildByName("deal_cards_seat34").getChildByName("poker3");Laya.Tween.to(i,{x:e},100)}let m=r?0:C.instance._speed.moveCard;r||1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(C.instance._music.dealCards,1),Laya.Tween.to(t,{x:c,y:g,scaleX:.9,scaleY:.9,rotation:0},m,null,Laya.Handler.create(this,this.moveCard3Or4End,[e,t,i,s,o,n,r,h]))}}moveMeCardEnd(e,t,i,s,o,n,r,h){C.instance._dealNumber++,r||1==a.gameSetVal.gameMusic&&(C.instance.$LOG("进来音效"),Laya.SoundManager.playSound(C.instance._music.fanCards,1));let l=r?0:C.instance._speed.fanCard;Laya.Tween.to(t,{scaleX:0},l,null,Laya.Handler.create(this,this.fanCardMePokerEnd,[t,i,o,r])),C.instance._dealNumber==s&&h&&h.call(e)}fanCardMePokerEnd(e,t,i,a){t>=3&&(e.getChildByName("showSign").visible=!0),e.loadImage("res/img/poker/"+i+".png",Laya.Handler.create(this,this.changeMeFanPokerEnd,[e,a]))}changeMeFanPokerEnd(e,t){let i=t?0:C.instance._speed.fanCard;Laya.Tween.to(e,{scaleX:1.3,alpha:1},i)}moveCardEnd(e,t,i,a,s,o){C.instance._dealNumber++,s&&!this.owner.isMe&&Laya.Tween.to(t,{alpha:1},0),C.instance._dealNumber==i&&o&&o.call(e)}moveCard3Or4End(e,t,i,s,o,n,r,h){C.instance._dealNumber++,C.instance._dealNumber==s&&h&&h.call(e);let l=r?0:C.instance._speed.fanCard;r||1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(C.instance._music.fanCards,1),Laya.Tween.to(t,{scaleX:0},l,null,Laya.Handler.create(this,this.fanCardPokerEnd,[e,t,i,s,o,n,r,h]))}fanCardPokerEnd(e,t,i,a,s,o,n,r){t.loadImage("res/img/poker/"+s+".png",Laya.Handler.create(this,this.changeFanPokerEnd,[e,t,a,o,n,r]))}changeFanPokerEnd(e,t,i,a,s,o){let n=s?0:C.instance._speed.fanCard;Laya.Tween.to(t,{scaleX:.9,alpha:1},n)}showActionTip(e,t){this.$y=28;let i=this.owner.getChildByName("tipsBox");i.visible=e,i.y=this.$y,Laya.timer.clear(this,this.TimeEnd),e?(i.loadImage("res/img/Action/Action"+t+".png",Laya.Handler.create(this,this.loadTipEnd,[i])),this.owner.actionType=t):this.owner.actionType=null}loadTipEnd(e){k=0,Laya.timer.frameLoop(2,this,this.TimeEnd,[e])}TimeEnd(e){++k%2==0?Laya.Tween.to(e,{y:this.$y+20},100):Laya.Tween.to(e,{y:this.$y},100),k>=5&&Laya.timer.clear(this,this.TimeEnd)}diuPoker(){let e=this.owner.getChildByName("deal_cards_seat");this.owner.isMe&&(e.getChildByName("poker1").alpha=1,e.getChildByName("poker2").alpha=1);let t=e.globalToLocal(new Laya.Point(Laya.stage.width/2,Laya.stage.height/2)),i=t.x+this.owner._diuPokerSeatXY.x,a=t.y+this.owner._diuPokerSeatXY.y;Laya.Tween.to(e,{rotation:360},C.instance._speed.diuRotation),Laya.Tween.to(e,{x:i,y:a},C.instance._speed.diu,null,Laya.Handler.create(this,this.diuMoveEnd,[e]))}diuMoveEnd(e){1==a.gameSetVal.gameMusic&&Laya.SoundManager.playSound(C.instance._music.diu,1),e.getChildByName("poker1").alpha=0,e.getChildByName("poker2").alpha=0,e.x=this.owner._diuPokerSeatXY.x,e.y=this.owner._diuPokerSeatXY.y}showBanker(e){this.owner.getChildByName("banker").visible=e}showPlayerSubResult(e,t){if(this.owner.isMe){let i=this.owner.getChildByName("show_me_sub_poker");if(i.visible=e,e){let e=i.getChildByName("sub1")._children,a=i.getChildByName("sub2")._children;e.forEach((e,i)=>{"pokerBox"===e.name?e.loadImage("res/img/poker/"+t.sub1.data[i]+".png"):"pointBox"===e.name&&(e.getChildByName("pointText").text=t.sub1.point)}),a.forEach((e,i)=>{"pokerBox"===e.name?e.loadImage("res/img/poker/"+t.sub2.data[i]+".png"):"pointBox"===e.name&&(e.getChildByName("pointText").text=t.sub2.point)})}}else{let i=this.owner.getChildByName("sub_poker_box");if(i.visible=e,!e){this.owner.getChildByName("show_me_sub_poker").visible=e}if(e){let e=i.getChildByName("sub1")._children,a=i.getChildByName("sub2")._children;e.forEach((e,i)=>{"pokerBox"===e.name?e.loadImage("res/img/poker/"+t.sub1.data[i]+".png"):"pointBox"===e.name&&(e.getChildByName("pointText").text=t.sub1.point)}),a.forEach((e,i)=>{"pokerBox"===e.name?e.loadImage("res/img/poker/"+t.sub2.data[i]+".png"):"pointBox"===e.name&&(e.getChildByName("pointText").text=t.sub2.point)})}}}showPlayerXiuView(e,t){let i=this.owner.getChildByName("xiuPokerBox");if(i.visible=e,e){let e=i.getChildByName("xiuPoker1"),a=i.getChildByName("xiuPoker2");e.loadImage("res/img/poker/-1.png"),a.loadImage("res/img/poker/-1.png"),t.forEach((t,i)=>{0==i?Laya.Tween.to(e,{scaleX:0},C.instance._speed.xiuFan,null,Laya.Handler.create(this,this.xiuPokerFanEnd,[e,t])):Laya.Tween.to(a,{scaleX:0},C.instance._speed.xiuFan,null,Laya.Handler.create(this,this.xiuPokerFanEnd,[a,t]))})}}xiuPokerFanEnd(e,t){e.loadImage("res/img/poker/"+t+".png",Laya.Handler.create(this,this.loadXiuPokerEnd,[e]))}loadXiuPokerEnd(e){e.getChildByName("showSign").visible=!0,Laya.Tween.to(e,{scaleX:.7},C.instance._speed.xiuFan)}showPlayerLastWinScore(e,t){let i=this.owner.getChildByName("winScore");if(i.visible=e,e){let e=i.getChildByName("value");e.text="",e.text=t}}playerSeatAddGif(e=!0,t=a.animations.qiao){let i=this.owner.getChildByName("gifBox");i.visible=e;let s=i.getChildByName("playerGIF"+t);if(s&&s.removeSelf(),this.aniTimeID&&clearTimeout(this.aniTimeID),e){Laya.loader.load("res/atlas/images/GIF/"+t+".atlas",Laya.Handler.create(this,function(){let e=new Laya.Animation;e.name="playerGIF"+t,e.pos(this.owner.pivotX,this.owner.pivotY),e.loadAnimation("animation/"+t+".ani"),i.addChild(e),e.play()}))}}playerSeatAddExpression(e=!0,t=0,i=!0){let a=this.owner.getChildByName("gifBox");a.visible=e;let s=a.getChildByName("expressionAni");if(s&&s.removeSelf(),this.aniTimeID&&clearTimeout(this.aniTimeID),e){Laya.loader.load("res/atlas/images/GIF/expression.atlas",Laya.Handler.create(this,function(){let e=new Laya.Animation;e.name="expressionAni",e.pos(this.owner.pivotX,this.owner.pivotY),e.loadAnimation("animation/expression/"+t+".ani"),a.addChild(e),e.play(),i&&(this.aniTimeID=setTimeout(()=>{let e=a.getChildByName("expressionAni");e&&e.removeSelf(),a.visible=!1,clearTimeout(this.aniTimeID)},4e3))}))}}playerSeatAddFastChat(e){x.openSeatChatView(this,e)}playerSeatAddRotationGif(e=!0){let t=this.owner.getChildByName("gifBox"),i=t.getChildByName("WIN"),a=t.getChildByName("WIN_IMG");t.visible=e,i.visible=e,a.visible=e,i.rotation=0,e?Laya.timer.loop(1,this,this.winRotation,[i]):Laya.timer.clear(this,this.winRotation)}winRotation(e){e.rotation+=4}}class T extends Laya.Script{constructor(){super()}onEnable(){this.owner.width=parseInt((this.owner.width/(1242/Laya.stage.width)).toFixed(0)),this.owner.height=parseInt((this.owner.height/(2208/Laya.stage.height)).toFixed(0))}onDisable(){}}class E extends Laya.Script{constructor(){super(),this.loadArrLength=0,this.loadReturnArr=[]}onEnable(){this.getForm(),this.getUserInfo(),this.hideLoadingView()}getForm(){a.wxGame=Laya.Browser.onWeiXin,a.$LOG("是不是微信平台===:",a.wxGame)}getUserInfo(){a.userInfo=a.wxGame?wx.getStorageSync("userInfo"):JSON.parse(localStorage.getItem("userInfo"))}hideLoadingView(){a.wxGame?this.onLoading():setTimeout(()=>{document.getElementById("startImg").style.opacity=0,this.onLoading()},1e3)}onLoading(){a.beforeLoadScene(this,e=>{this.dealWithBeforeLoadScene(e)}),a.createLoading(a.loadingType.one),a.createLoading(a.loadingType.two),a.createLoading(a.loadingType.three),a.createTipBox(),a.getStatusHeight(),a.createDiaLog(),this.loadArrLength=a.loadScene.length}dealWithBeforeLoadScene(e){let t=this.owner.progressBg.getChildByName("progress");this.loadReturnArr.push(e);let i=parseInt(this.loadReturnArr.length/this.loadArrLength*100);t.width=this.owner.progressBg.width*(i/100),this.owner.loadRate.text=i+"%",i>=100&&(this.owner.loadText.text="加载完成,祝您好运!",setTimeout(()=>{a.wxGame||(document.getElementById("startImg").style.display="none"),Laya.Scene.open("login.scene",!0)},500))}}class P extends Laya.Script{constructor(){super(),this.callback=null,this.callbackThis=null,this.switchState=!0}onEnable(){this.bindEvent(),this.initSwitch(null,!0)}initSwitch(e,t=!0,i){this.callbackThis=e,this.callback=i,this.owner.getChildByName("yes").visible=!!t}bindEvent(){this.owner.on(Laya.Event.CLICK,this,this.clickSwitch)}clickSwitch(){let e=this.owner.getChildByName("yes");e.visible=!e.visible,this.switchState=e.visible,this.callback&&this.callback.call(this.callbackThis,this.switchState)}}class M extends Laya.Script{constructor(){super()}onStart(){this.initBack(),this.setList()}initBack(){this.owner.back.getComponent(s).initBack()}setList(){let e=this.owner.ctList;e.array=[{id:1,label:"res/img/common/set_text1.png"},{id:2,label:"res/img/common/set_text2.png"},{id:3,label:"res/img/common/set_text3.png",BanBenVal:"1.0.0"}],e.renderHandler=new Laya.Handler(this,this.listRender),e.mouseHandler=new Laya.Handler(this,this.listSelect)}listRender(e){if(e.getChildByName("label").skin=e.dataSource.label,1!=e.dataSource.id){e.getChildByName("selectView").removeSelf()}if(1==e.dataSource.id&&this.initSwitch(e),2!=e.dataSource.id){e.getChildByName("goIconBox").removeSelf()}if(3!=e.dataSource.id){e.getChildByName("testBox").removeSelf()}}listSelect(e,t){if("click"==e.type){2==e.target.dataSource.id&&a.$openScene("aboutOur.scene",!1,this.openDta,e=>{e.x=Laya.stage.width,e.zOrder=10,Laya.Tween.to(e,{x:0},a._speed.page)})}}initSwitch(e){let t=e.getChildByName("selectView").getComponent(P),i=0!=(localStorage.getItem("gameMusic")?localStorage.getItem("gameMusic"):1);t.initSwitch(this,i,e=>{let t=e?1:0;localStorage.setItem("gameMusic",t)})}}class D extends Laya.Script{constructor(){super(),this.openType=0,this.openSceneUrl="",this.openCloseOtherScene=!1,this.openDta=null,this.openMethod=0,this.selfScene=""}initOpen(e,t,i,a,s){this.openType=e||0,this.openSceneUrl=t||"",this.openCloseOtherScene=i||!1,this.openDta=a||null,this.openMethod=s||0}onEnable(){this.selfScene=this.owner.scene,this.initOpen(),this.bindEvent()}bindEvent(){this.owner.on(Laya.Event.CLICK,this,this.openView)}openView(){a.$LOG(this.openSceneUrl),a.$openScene(this.openSceneUrl,this.openCloseOtherScene,this.openDta,e=>{0==this.openMethod&&(e.x=Laya.stage.width,e.zOrder=10,Laya.Tween.to(e,{x:0},a._speed.page,null,Laya.Handler.create(this,()=>{1==this.openType&&this.selfScene.removeSelf()})))})}}class A extends Laya.Script{constructor(){super(),this.flag=!0}onEnable(){this.phone=this.owner.phone_value,this.pwd=this.owner.pwd_value}onStart(){this.initOpenView(),this.startLoadPage()}startLoadPage(){let e=a.wxGame?wx.getStorageSync("userInfo"):JSON.parse(localStorage.getItem("userInfo"));e&&(this.phone.text=e.user?e.user:"",this.pwd.text=e.pwd?e.pwd:"",""==this.phone.text||""==this.phone.text.trim("")||""==this.pwd.text||""==this.pwd.text.trim("")||this.owner.loginState||this.login())}login(){if(this.flag){this.flag=!1,a.showLoading(!0);let e=this.phone.text,t=this.pwd.text;if(""==e)return this.flag=!0,a.showDiaLog("账号不能为空!"),a.showLoading(!1),!1;if(""==t)return this.flag=!0,a.showDiaLog("密码不能为空!"),a.showLoading(!1),!1;let i={pws:t};i=escape(JSON.stringify(i));let s={acc:e,ip:"192.168.0.112",type:"accpws",json:i,devid:Laya.Browser.onAndroid?"Android":"PC"};c.$request({that:this,url:"/M.Acc/Login",data:s,success(i){if(0==i.data.ret.type){let a={user:e,pwd:t,userId:i.data.userId,key:i.data.key,inRoomPws:i.data.inRoomPws,init:i.data.init};this.changeMainUserInfo(a),this.dealWithLoginedView(a)}else this.flag=!0,a.showLoading(!1),a.showDiaLog(i.data.ret.msg)},fail(){this.flag=!0,a.showLoading(!1)}})}}changeMainUserInfo(e){a.wxGame?wx.setStorageSync("userInfo",e):localStorage.setItem("userInfo",JSON.stringify(e)),a.userInfo=e}dealWithLoginedView(e){let t={roomPws:e.inRoomPws,page:a.pages.page3};if(e.init)Laya.Scene.open("tabPage.scene",!0,t,Laya.Handler.create(this,e=>{a.showLoading(!1),clearTimeout(this.loadTimeID),this.flag=!0}),Laya.Handler.create(this,()=>{this.loadTimeID=setTimeout(()=>{a.showLoading(!1),a.$LOG("加载超时！"),clearTimeout(this.loadTimeID)},1e4)}));else{let t={page:a.pages.page6,userId:e.userId};a.$openScene("playerNewsSet.scene",!1,t,e=>{e.x=Laya.stage.width,e.zOrder=10,Laya.Tween.to(e,{x:0},a._speed.page,null,Laya.Handler.create(this,()=>{a.showLoading(!1),clearTimeout(this.loadTimeID),this.flag=!0}))})}}initOpenView(){let e={page:a.sign.register};this.owner.register_btn.getComponent(D).initOpen(1,"register.scene",!1,e,0);let t={page:a.sign.changePwd};this.owner.change_btn.getComponent(D).initOpen(1,"register.scene",!1,t,0)}}class O extends Laya.Scene{constructor(){super()}onAwake(){this._LoginJS=this.getComponent(A),this.login_btn.on(Laya.Event.CLICK,this,this.login)}onOpened(e){this.opendNumber=0,this.loginState=e||null}login(){this._LoginJS.login()}}class R extends Laya.Scene{constructor(){super()}onOpened(e){a.$LOG("房间结束界面所收到的值:",e),this._openedData=e,this.visible=!!e.show&&e.show,this.setUI()}setUI(){let e=[this.e_bg2];a.setNodeTop(e)}}class V extends Laya.Script{constructor(){super()}onEnable(){}onStart(){a.$LOG("房间结束脚本：",this.owner._openedData),this.owner._openedData.show&&(this.owner.zOrder=10,this.setPageData(this.owner._openedData.data),this.setPageListData(this.owner._openedData.data),this.closeSoket(),this.registerEvent())}onDisable(){}setPageData(e){this.owner.e_name.text=e.nick,this.owner.e_userId.text="["+e.userId+"]",this.owner.e_timeLong.text=a.secondToDate(e.roomTime),a.$LoadImage(this.owner.e_head,"res/img/head/"+e.head+".png",a.defaultImg.one,"skin"),this.owner.e_ct2_name.text=e.nick,this.owner.e_ct2_ID.text=e.userId,this.owner.e_score.text=e.self_sf,this.owner.e_ct3_tb1.text=e.self_shoushu,this.owner.e_ct3_tb2.text=e.all_shoushu,this.owner.e_ct3_tb3.text=e.all_dairu}setPageListData(e){let t=this.owner.end_list;t.visible=!0,t.array=e.participant,t.vScrollBarSkin="",t.renderHandler=new Laya.Handler(this,this.pageListOnRender)}pageListOnRender(e){let t=e.getChildByName("c1"),i=e.getChildByName("c2"),a=e.getChildByName("c3");t.text=e.dataSource.nick,i.text=e.dataSource.dairu,a.text=e.dataSource.sf}registerEvent(){this.owner.end_close.on(Laya.Event.CLICK,this,this.onClickClose)}closeSoket(){C.instance.onClose()}onClickClose(){a.$openScene("tabPage.scene",!0,{page:this.owner._openedData.page})}}class U extends Laya.Scene{constructor(){super(),this._debug=!1}onEnable(){a.$LOG("牌局回顾场景：",this),this.diaLogMask.on(Laya.Event.CLICK,this,this.back)}back(){Laya.Tween.to(this.paijuhuiguBg,{right:-this.paijuhuiguBg.width},150,null,Laya.Handler.create(this,()=>{this.removeSelf()}))}onDisable(){}onOpened(e){a.$LOG("打开牌局回顾场景接受所传的参数:",e),this.openData=e,this.setUI()}setUI(){let e=[this.list_bg];a.setNodeTop(e)}}class X extends Laya.Script{constructor(){super()}onEnable(){}onStart(){a.$LOG("组件信息：",this),this.setPersonListRowNum()}onDisable(){}setPersonListRowNum(){let e=this.owner.getChildByName("paijuhuiguBg");e.right=-e.width,this.owner.x=0,this.owner.zOrder=10,this.owner.diaLogMask.visible=!0,Laya.Tween.to(e,{right:0},150,null,Laya.Handler.create(this,this.showEnd))}showEnd(){c.$request({that:this,url:"/M.Games.CX.Ext/Log/GetPokerLog",data:{uid:this.owner.openData.userId,roomid:this.owner.openData.roomId,page:1},success(e){0==e.data.ret.type?this.setPageData(e.data):console.log(e.data.ret.msg)}}),this.owner.preBtn.on(Laya.Event.CLICK,this,this.clickTurn,[1]),this.owner.nextBtn.on(Laya.Event.CLICK,this,this.clickTurn,[2])}clickTurn(e){2==e?(this.owner.preText.text=parseInt(this.owner.preText.text)+1,this._LIST.length<=30?this.owner.preText.text=this.owner.preText.text>this._LIST.length?this._LIST.length:this.owner.preText.text:this.owner.preText.text=this.owner.preText.text>30?30:this.owner.preText.text):(this.owner.preText.text-=1,this.owner.preText.text=this.owner.preText.text<1?1:this.owner.preText.text,0==this._LIST.length&&(this.owner.preText.text=0)),this.setList(this.owner.preText.text-1)}setPageData(e){a.$LOG("获取牌局回顾数据：",e),this.owner.allSSValue.text=e.maxCount,this.owner.nextText.text=e.maxCount<=30?e.maxCount:30,this.owner.preText.text=e.maxCount<=30?e.maxCount:30,this._LIST=e.pokerLog,this.setList(this._LIST.length-1)}setList(e){let t=this.owner.paiJuList;t.visible=!0,t.vScrollBarSkin="",t.array=this._LIST[e],t.renderHandler=new Laya.Handler(this,this.listOnRender)}listOnRender(e,t){let i=e.getChildByName("personNews"),s=i.getChildByName("name"),o=i.getChildByName("headBg").getChildByName("head"),r=i.getChildByName("zt"),h=i.getChildByName("zhuang");s.text=e.dataSource.name;let l="res/img/head/"+e.dataSource.head+".png";a.$LoadImage(o,l,a.defaultImg.one),h.visible=e.dataSource.zhuang,2==e.dataSource.opt?r.loadImage("res/img/common/status_1.png"):1==e.dataSource.opt?r.loadImage("res/img/common/status_0.png"):0==e.dataSource.opt&&r.loadImage("");let d=e.getChildByName("dataView"),c=d.getChildByName("mangScore"),g=d.getChildByName("xiaZhu"),m=d.getChildByName("getScore");g.text=e.dataSource.xiazhu,c.visible=e.dataSource.mang>0,c.text=e.dataSource.mang>0?e.dataSource.mang:0,e.dataSource.sfscore>0?m.text="+"+e.dataSource.sfscore:(e.dataSource.sfscore,m.text=e.dataSource.sfscore),-1!=m.text.indexOf("-")?m.color="#51A97A":-1!=m.text.indexOf("+")?m.color="#FF0000":m.color="#916014";e.dataSource.userId;let p=e.getChildByName("noSHPokerBox"),y=e.getChildByName("SHPokerBox"),u=p.getChildByName("leftPoker"),w=p.getChildByName("rightPoker"),_=y.getChildByName("leftPoker"),C=y.getChildByName("rightPoker"),S=null,L="",b="",x=u.getChildByName("pointText"),v=w.getChildByName("pointText");e.dataSource.pokers.length>=3&&(S=n.sanHuaPoker(e.dataSource.pokers[0].poker,e.dataSource.pokers[1].poker,e.dataSource.pokers[2].poker),2!=e.dataSource.opt||S?2!=e.dataSource.opt&&(x.text="",v.text=""):(L=n.countPoint(e.dataSource.pokers[0].poker,e.dataSource.pokers[1].poker),b=n.countPoint(e.dataSource.pokers[2].poker,e.dataSource.pokers[3].poker),x.text=L,v.text=b)),e.dataSource.pokers.forEach((t,i)=>{if(2==e.dataSource.pokers.length){p.visible=!0,y.visible=!1;let e="poker"+(i+1),a=u.getChildByName(e),s=u.getChildByName("poker"+(i+1)),o=w.getChildByName("poker"+(i+3)),n=a.getChildByName("showPokerSign");a.loadImage("res/img/poker/"+t.poker+".png"),o.loadImage(""),n.visible=t.isShow,x.text="",v.text="";let r=s.getChildByName("sign"),h=o.getChildByName("sign");r.visible=!1,h.visible=!1}else if(p.visible=!S,y.visible=!!S,S){let e="poker"+(i+1);(i<=2?_.getChildByName(e):C.getChildByName(e)).loadImage("res/img/poker/"+t.poker+".png")}else{let a="poker"+(i+1),s=i<=1?u.getChildByName(a):w.getChildByName(a),o=i<=1?s.getChildByName("showPokerSign"):null,n=s.getChildByName("sign");s.loadImage("res/img/poker/"+t.poker+".png"),o&&(o.visible=2!=e.dataSource.opt&&t.isShow),n.visible=2==e.dataSource.opt&&t.isdipoker;let r=w.getChildByName("poker4");3==e.dataSource.pokers.length&&r.loadImage("")}})}}class H extends Laya.Scene{constructor(){super(),this._debug=!1}$LOG(...e){this._debug&&console.log(...e)}onEnable(){this.$LOG("实时战绩厂场景：",this),this.diaLogMask.on(Laya.Event.CLICK,this,this.back)}back(){Laya.Tween.to(this.paijutishiBg,{x:-Laya.stage.width},150,null,Laya.Handler.create(this,()=>{this.removeSelf()}))}onDisable(){}onOpened(e){this.openData=e,e.show||(this.x=-Laya.stage.width)}}class G extends Laya.Script{constructor(){super()}onEnable(){}onStart(){this.owner.openData.show&&this.setPersonListRowNum(),a.$LOG("组件信息：",this)}onDisable(){}setPersonListRowNum(){let e=this.owner.getChildByName("paijutishiBg");e.x=-Laya.stage.width,this.owner.diaLogMask.visible=!0,Laya.Tween.to(e,{x:0},150)}}class F extends Laya.Script{constructor(){super(),this.sexType=1,this.name="",this.headId=1,this.flag=!0,this.fromPage="",this.userId=""}onStart(){this.setBack(),this.setSexList(),this.sexSelect(0),this.setHeadList(0),this.headSelect(),this.setSelectedHead(),this.fromPage=this.owner.openData.page,this.userId=this.owner.openData.userId,this.fromPage==a.pages.page5&&this.editGetNews()}editGetNews(){c.$request({that:this,url:"/M.User/GetInfo",data:{uid:a.userInfo.userId,tuid:this.userId},success(e){0==e.data.ret.type&&this.setNews(e.data)}})}setNews(e){let t=this.owner.name_value;this.headId=e.head,t.text=e.nick,this.sexType=e.sex;let i=0==e.sex?1:0;this.sexSelect(i),this.setHeadList(),this.setSelectedHead(),this.headSelect(parseInt(this.headId)-1)}setSexList(){let e=this.owner.sexList;e.array=[{icon0:"res/img/common/set_sex1_0.png",icon1:"res/img/common/set_sex1_1.png",value:1},{icon0:"res/img/common/set_sex0_0.png",icon1:"res/img/common/set_sex0_1.png",value:0}],e.renderHandler=new Laya.Handler(this,this.onRenderHandlerSexList)}onRenderHandlerSexList(e){let t=e.getChildByName("listRow").getChildByName("select").getChildByName("no"),i=e.getChildByName("listRow").getChildByName("select").getChildByName("yes");t.loadImage(e.dataSource.icon0),i.loadImage(e.dataSource.icon1)}sexSelect(e){this.owner.sexList.parent.getComponent(b).MySelect(this,e,e=>{this.sexType=e})}setHeadList(){let e=this.owner.headList;e.vScrollBarSkin="",e.array=[{headUrl:"res/img/head/1.png",value:1},{headUrl:"res/img/head/2.png",value:2},{headUrl:"res/img/head/3.png",value:3},{headUrl:"res/img/head/4.png",value:4}],e.renderHandler=new Laya.Handler(this,this.onRenderHandlerHeadList)}onRenderHandlerHeadList(e){e.getChildByName("listRow").getChildByName("select").getChildByName("no").skin=e.dataSource.headUrl}headSelect(e){this.owner.headList.parent.getComponent(b).MySelect(this,e,e=>{this.headId=e,this.setSelectedHead()})}setSelectedHead(){this.owner.headImg.skin="res/img/head/"+this.headId+".png"}setBack(){let e=this.owner.back.getComponent(s);this.owner.openData.page==a.pages.page6&&e.initBack(),this.owner.openData.page==a.pages.page5&&e.initBack(1,"tabPage.scene",{page:a.pages.page5})}Confrim(){a.showLoading(!0);let e=this,t=this.fromPage==a.pages.page6?"/M.User/SetUserInfo":"/M.User/ModifyUserInfo";if(this.flag){this.flag=!1;let i=this.owner.name_value.text;if(""==i||""==i.trim())return a.showDiaLog("昵称不能为空!"),this.flag=!0,void a.showLoading(!1);let s=this.fromPage==a.pages.page6?{uid:this.owner.openData.userId,sex:this.sexType,nick:i,head:this.headId}:{uid:this.owner.openData.userId,sex:this.sexType,nick:i,head:this.headId,signature:""};c.$request({that:this,url:t,data:s,success(t){t.status&&(this.fromPage==a.pages.page6?a.showDiaLog("设置成功",1,()=>{e.openNextView()}):this.fromPage==a.pages.page5&&a.showDiaLog("修改成功",1,()=>{e.openNextView2()}))},fail(){this.flag=!0,a.showLoading(!1)}})}}openNextView(){let e={roomPws:-1,page:a.pages.page3};Laya.Scene.open("tabPage.scene",!0,e,Laya.Handler.create(this,e=>{a.showLoading(!1),clearTimeout(this.loadTimeID),this.flag=!0}),Laya.Handler.create(this,()=>{this.loadTimeID=setTimeout(()=>{a.showLoading(!1),a.$LOG("加载超时！"),clearTimeout(this.loadTimeID)},1e4)}))}openNextView2(){this.flag=!0,a.showLoading(!1);let e=this.owner.back.getComponent(s);e.initBack(1,"tabPage.scene",{page:a.pages.page5}),e.back()}}class j extends Laya.Scene{constructor(){super()}onAwake(){this.playerNewsSetJS=this.getComponent(F),this.bindEvent()}onOpened(e){this.openData=e,this.setUI()}bindEvent(){this.confrim_btn.on(Laya.Event.CLICK,this,()=>{this.playerNewsSetJS.Confrim()})}setUI(){let e=[this.set_bg1,this.set_bg2];a.setNodeTop(e)}}class $ extends Laya.Script{constructor(){super()}setPageData(e){this._pageType=e.page,e.page==a.sign.register?(this.owner.title_1.visible=!0,this.owner.title_2.visible=!1,this.owner.register_btn.visible=!0,this.owner.change_btn.visible=!1):e.page==a.sign.changePwd&&(this.owner.title_1.visible=!1,this.owner.title_2.visible=!0,this.owner.register_btn.visible=!1,this.owner.change_btn.visible=!0)}onEnable(){}onStart(){this.initBack()}comfirmRegisterOrChange(){let e=this,t=this.owner.phone_value.text,i=this.owner.pwd_value.text,s=this.owner.code_value.text;if(""==t)return void a.showDiaLog("手机号不能为空！!");if(""==i)return void a.showDiaLog("密码不能为空!");if(""==s)return void a.showDiaLog("验证码不能为空!");let o={name:t,pws:i,code:s};3==this._pageType&&(o={name:t,now:i,code:s});let n=2==this._pageType?"/M.Acc/Register":"/M.Acc/ModifyPws";c.$request({that:this,url:n,data:o,success(s){if(0==s.data.ret.type){let s={user:t,pwd:i};a.wxGame?wx.setStorageSync("userInfo",s):localStorage.setItem("userInfo",JSON.stringify(s)),2==this._pageType?a.showDiaLog("注册成功,返回登录",1,()=>{e.back()},null,null,!1):a.showDiaLog("修改成功")}else a.showDiaLog(s.data.ret.msg)},fail(){}})}initBack(){let e=this.owner.back_btn.getComponent(s);return e.initBack(1,"login.scene",a.sign.signOut),e}back(){this.initBack().back()}}class Y extends Laya.Scene{constructor(){super()}onAwake(){this._RegisterJS=this.getComponent($),this.register_btn.on(Laya.Event.CLICK,this,this.comfirmRegisterOrChange),this.change_btn.on(Laya.Event.CLICK,this,this.comfirmRegisterOrChange)}onOpened(e){this._RegisterJS.setPageData(e),this.setUI()}comfirmRegisterOrChange(){this._RegisterJS.comfirmRegisterOrChange()}setUI(){let e=[this.register_list];a.setNodeTop(e)}}class Z extends Laya.Script{constructor(){super(),this.serviceUrl=""}onEnable(){this.setUI(),this.setPageData()}onStart(){this.initBack()}initBack(){this.owner.back.getComponent(s).initBack(null,null,null,this.iframe)}setPageData(){this.serviceUrl=a.serviceUrl,this.iframe=this.createIframeElement(),this.iframe.src=this.serviceUrl,this.iframe.id="myIframe",Laya.Utils.fitDOMElementInArea(this.iframe,this.owner.contentView,this.owner.x,0,this.owner.contentView.width,this.owner.contentView.height)}createIframeElement(){let e=Laya.Browser.createElement("iframe");return e.style.zIndex=Laya.Render.canvas.zIndex+1,Laya.Browser.document.body.appendChild(e),e}setUI(){let e=[this.owner.contentView];a.setNodeTop(e)}}class K extends Laya.Scene{constructor(){super()}onEnable(){a.$LOG("实时战绩厂场景：",this),this.diaLogMask.on(Laya.Event.CLICK,this,this.back)}back(){Laya.Tween.to(this.shishizhanjiBg,{x:-Laya.stage.width},150,null,Laya.Handler.create(this,()=>{this.removeSelf()}))}onDisable(){}onOpened(e){a.$LOG("打开实时战绩场景接受所传的参数:",e),this.openData=e,this.setUI()}setUI(){console.log(this.s_hd.top);let e=[this.s_hd,this.s_bg1,this.s_bg3];a.setNodeTop(e)}}class z extends Laya.Script{constructor(){super()}onEnable(){}onStart(){a.$LOG("组件信息：",this),this.setPersonListRowNum()}onDisable(){}setPersonListRowNum(){let e=this.owner.getChildByName("shishizhanjiBg");this.owner.x=0,this.owner.zOrder=10,this.owner.diaLogMask.visible=!0,e.x=-Laya.stage.width,Laya.Tween.to(e,{x:0},150,null,Laya.Handler.create(this,this.showEnd))}showEnd(){c.$request({that:this,url:"/M.Games.CX.Ext/Record/RealTimeRecord",data:{uid:a.userInfo.userId,roomid:this.owner.openData.roomId},success(e){0==e.data.ret.type?this.setPageData1(e.data.data):a.showTip(e.data.ret.msg)}})}setPageData1(e){a.$LOG("获取实时战绩的表格1数据：",e),this.TimeID&&clearInterval(this.TimeID),this.TimeID=setInterval(()=>{e.end_time--,this.owner.roomLastTime.text=a.secondToDate(e.end_time),0==e.end_time&&clearInterval(this.TimeID)},1e3),this.owner.allDaiRuValue.text=e.all_dairu,this.owner.allGetScore.text=e.all_sf,setTimeout(()=>{this.owner.weiGuanTitle.width=this.owner.weiGuanTitle.getChildAt(0).textWidth}),this.owner.weiGuanTitle.text="（"+e.onlooker.length+"）",this.setList1(e.dairu),this.setList2(e.onlooker)}setList1(e){let t=this.owner.zhanjiList;t.visible=!0,t.vScrollBarSkin="",t.array=e,t.renderHandler=new Laya.Handler(this,this.list1OnRender)}list1OnRender(e,t){let i=e.getChildByName("name"),a=e.getChildByName("dairu"),s=e.getChildByName("score");i.text=e.dataSource.nick,a.text=e.dataSource.dairu,s.text=e.dataSource.sf,0===parseInt(s.text)?s.color="#935F13":-1!=s.text.indexOf("+")?s.color="#c53233":-1!=s.text.indexOf("-")&&(s.color="#599E73")}setList2(e){let t=this.owner.PersonList;t.visible=!0,t.vScrollBarSkin="",t.array=e,t.renderHandler=new Laya.Handler(this,this.list2OnRender)}list2OnRender(e,t){let i=e.getChildByName("name"),s=e.getChildByName("headBg").getChildByName("head"),o="res/img/head/"+e.dataSource.head+".png";a.$LoadImage(s,o,a.defaultImg.one,"skin"),i.text=e.dataSource.nick}}class q extends Laya.Script{constructor(){super(),this.isTabPage=!0}onStart(){this.setBack(),this.getPageData()}setBack(){this.isTabPage=!this.owner.openedData||this.owner.openedData.isTabPage;let e=this.owner.shop_back_btn.getComponent(s);this.isTabPage?e.initBack(1,"tabPage.scene",{page:a.pages.page5}):e.initBack()}getPageData(){c.$request({that:this,url:"/M.Shop/GetShopInfo",data:{uid:a.userInfo.userId},success(e){0==e.data.ret.type&&this.setList(e.data.shopList._v[0].shopTemplates)}})}setList(e){let t=this.owner.s_list;e.forEach(e=>{e.icon="res/img/shop/2.png",e.text="res/img/shop/"+e.score+".png",e.btn="res/img/shop/"+e.money+"_btn.png"}),t.array=e,t.vScrollBarSkin="",t.renderHandler=new Laya.Handler(this,this.listRender)}listRender(e,t){let i=e.getChildByName("icon"),a=e.getChildByName("text"),s=e.getChildByName("btn").getChildByName("value");i.skin=e.dataSource.icon,a.skin=e.dataSource.text,s.skin=e.dataSource.btn,this.bindEvent(s,e)}bindEvent(e,t){e.on(Laya.Event.CLICK,this,this.clickBtn,[t])}clickBtn(e){a.showDiaLog("您确认充值"+e.dataSource.score+"积分?",1,()=>{c.$request({that:this,url:"/M.Shop/PlayerRecharge",data:{uid:a.userInfo.userId,shopId:e.dataSource.shopId,shopType:1e3},success(e){0==e.data.ret.type&&a.showDiaLog(e.data.ret.msg)}})})}}class W extends Laya.Scene{constructor(){super()}onAwake(){}onOpened(e){this.openedData=e,this.setUI()}setUI(){let e=[this.shop_content];a.setNodeTop(e)}}var J=new class{open(e){this.TABUI=e.UI,this.TABUI.tabPagesDialogBox.visible=!0,this.TABUI.share_dialog.show(),this.bindEvent()}bindEvent(){this.TABUI.tabPagesDialogBox.on(Laya.Event.CLICK,this,this.clickMask),this.TABUI.s_close.on(Laya.Event.CLICK,this,this.clickMask)}clickMask(){this.close()}close(){this.TABUI&&(this.TABUI.share_dialog.close(),this.TABUI.tabPagesDialogBox.visible=!1)}};class Q extends Laya.Script{constructor(){super()}onEnable(){a.$LOG("Me脚本：",this),Q.instance=this}openThisPage(){this.owner.visible&&(this.UI=this.owner.scene,this.registerEvent(),this.requestPageData(),this.initOpenView())}initOpenView(){let e={page:a.pages.page5,userId:a.userInfo.userId};this.UI.headView.getComponent(D).initOpen(1,"playerNewsSet.scene",!1,e,0);let t={page:a.pages.page5,isTabPage:!0};this.UI.recharge_btn.getComponent(D).initOpen(1,"shoppingMall.scene",!1,t,0),this.UI.set_btn.getComponent(D).initOpen(0,"gameSet.scene",!1,null,0),this.UI.our_btn.getComponent(D).initOpen(0,"aboutOur.scene",!1,null,0),this.UI.customer_btn.getComponent(D).initOpen(0,"service.scene",!1,null,0)}registerEvent(){this.UI.signOut_btn.on(Laya.Event.CLICK,this,this.openLoginView),this.UI.share_btn.on(Laya.Event.CLICK,this,this.openShareView)}openLoginView(){a.showDiaLog("是否退出重新登录?",2,()=>{a.allowGameHallSetInterval=!1,Laya.Scene.open("login.scene",!0,a.sign.signOut)})}openServiceView(){}openShareView(){J.open(this)}requestPageData(){let e={uid:a.userInfo.userId,tuid:a.userInfo.userId};c.$request({that:this,url:"/M.User/GetInfo",data:e,success(e){0==e.data.ret.type?this.setPageData(e.data):a.showDiaLog(e.data.ret.msg)},fail(){}})}setPageData(e){let t="res/img/head/"+e.head+".png";a.$LoadImage(this.UI.headUrl,t,a.defaultImg.one),this.UI.userNameValue.text=e.nick,this.UI.userIDValue.text=e.userId,this.UI.userScoreValue.text=e.score,this.UI.me_sex0.visible=0==e.sex,this.UI.me_sex1.visible=1==e.sex,a.serviceUrl=e.service}}class ee extends Laya.Script{constructor(){super(),this._page={page1:"systemNotice",page2:"myNews"}}onEnable(){a.$LOG("Notice脚本：",this),ee.instance=this}openThisPage(){this.owner.visible&&(this.UI=this.owner.scene,this.openSelectView(this._page.page1),this.registerEvent())}registerEvent(){this.UI.systemNotice_box.on(Laya.Event.CLICK,this,this.openSelectView,[this._page.page1]),this.UI.myNews_box.on(Laya.Event.CLICK,this,this.openSelectView,[this._page.page2])}reloadSelectZt(){this.UI.systemNotice.visible=!1,this.UI.myNews.visible=!1}openSelectView(e){this.reloadSelectZt(),this.UI[e].visible=!0,e==this._page.page1&&this.requestSystemData()}requestSystemData(){a.showLoading(!0),c.$request({that:this,url:"/M.Lobby/Popularize/GetNoticeData",data:{uid:a.userInfo.userId},success(e){a.$LOG("获取公告数据:",e),a.showLoading(!1),this.setPage1(e)},fail(e){a.showLoading(!1)}})}setPage1(e){this.openSystemList(e)}openSystemList(e){this.systemList=this.UI.sysytem_list,this.systemList.vScrollBarSkin="",this.systemList.array=e.data.requestDatas,this.systemList.renderHandler=new Laya.Handler(this,this.systemListOnRender)}systemListOnRender(e){e.getChildByName("sysytem_content").skin=e.dataSource.title}}class te extends Laya.Script{constructor(){super(),this.moveUpFn,this.listScrollBarSlider=null}onEnable(){this.list=this.owner,a.$LOG("下拉列表：",this.list),this.bindEvent(),this.addShowNode(),this.getSmallLoading()}getSmallLoading(e=a.loadingType.four){Laya.loader.load("res/atlas/images/common.atlas",Laya.Handler.create(this,function(){this.smallLoading=new Laya.Animation,this.smallLoading.visible=!1,this.smallLoading.loadAnimation("animation/loading/"+e+".ani"),this.smallLoading.pos(30,28),this.iconBox.addChild(this.smallLoading)}))}addShowNode(){this.iconBox=new Laya.Image,this.iconBox.size(60,60),this.iconBox.centerY=0,this.p=new Laya.Panel,this.p.visible=!1,this.p.size(360,60),this.p.top=0,this.p.centerX=0,this.p.zOrder=-1,this.text=new Laya.Label,this.text.text="",this.text.color="#935F13",this.text.fontSize=40,this.text.width=270,this.text.top=0,this.text.bottom=0,this.text.valign="middle",this.text.align="center",this.text.centerX=0,this.p.addChild(this.text),this.p.addChild(this.iconBox),this.list.addChild(this.p)}changeIcon(e=1,t="res/img/common/icon2.png"){this.smallLoading.visible=!1,this.smallLoading.stop(),this.iconBox.loadImage(""),1==e?this.iconBox.loadImage(t):2==e&&(this.iconBox.loadImage(""),this.smallLoading.visible=!0,this.smallLoading.play())}bindChangeEvent(){this.list.scrollBar.changeHandler=new Laya.Handler(this,e=>{this.p.visible=e<=-40})}bindEvent(){this.list.off(Laya.Event.MOUSE_MOVE),this.list.off(Laya.Event.MOUSE_UP),this.list.off(Laya.Event.MOUSE_OUT),this.list.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove),this.list.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),this.list.on(Laya.Event.MOUSE_OUT,this,this.onMouseUp)}onMouseMove(){if(this.list.array.length>0){let e=this.list.scrollBar.value;e<=0&&e>=-100&&(this.p.height=-parseInt(e)),e<-100&&(this.p.height=100),this.p.visible=e<=-40,e>-100?(this.changeIcon(),this.setTest("下拉刷新")):e<=-100&&(this.changeIcon(1,"res/img/common/icon1.png"),this.setTest("释放立即刷新"))}else this.setTest("")}onMouseUp(){if(this.list.array.length>0){let e=this.list.scrollBar.value;e<0&&e<=-100&&(this.listScrollBarSlider.min=-100,this.moveUpFn&&(this.setTest("正在刷新..."),this.changeIcon(2),this.moveUpFn.call(this.callThis,e,e=>{this.setTest(e),this.changeIcon(0),setTimeout(()=>{this.p.visible=!1},500)})))}}setTest(e="下拉刷新"){this.text.text=e}initCall(e,t){this.listScrollBarSlider=this.list.scrollBar.slider,this.bindChangeEvent(),this.callThis=e,this.moveUpFn=t}}class ie extends Laya.Script{constructor(){super(),this._navType={all:1,small:2,center:3,big:4},this._selectNavType=1}onEnable(){a.$LOG("Hall游戏大厅脚本：",this),ie.instance=this}openThisPage(){this.owner.visible&&(this.UI=this.owner.scene,this.registerEvent(),this.selectThisTab(this.UI.hall_nav_bg._children[1],1),a.allowRequesList&&Laya.timer.loop(6e4,this,this.requestPageData,[!1]))}registerEvent(){this.UI.hall_nav_bg._children.forEach((e,t)=>{t>0&&e.on(Laya.Event.CLICK,this,this.selectThisTab,[e,t])})}reloadNavSelectZT(){this.UI.hall_nav_bg._children.forEach((e,t)=>{t>0&&(e.getChildByName("btn").visible=!1)})}selectThisTab(e,t){this.reloadNavSelectZT(),e.getChildByName("btn").visible=!0,this._selectNavType=t,this.requestPageData(!0)}setPage1Data(e){let t=this.UI.gameHall_page1_list;t.vScrollBarSkin="",t.array=e,t.renderHandler=new Laya.Handler(this,this.page1ListOnRender),t.mouseHandler=new Laya.Handler(this,this.rowOnClick),this.watchListMove(t),t.visible=!0}watchListMove(e){e.getComponent(te).initCall(this,(e,t)=>{this.callFn=t,setTimeout(()=>{this.selectThisTab(this.UI.hall_nav_bg._children[this._selectNavType],this._selectNavType)},500)})}page1ListOnRender(e,t){let i=e.getChildByName("content_bg"),s=i.getChildByName("roomID").getChildByName("value"),o=i.getChildByName("num1").getChildByName("value"),n=i.getChildByName("online").getChildByName("value"),r=i.getChildByName("time").getChildByName("value"),h=i.getChildByName("lastTime").getChildByName("value"),l=i.getChildByName("state").getChildByName("state_0"),d=i.getChildByName("state").getChildByName("state_1"),c=i.getChildByName("state").getChildByName("state_2"),g=i.getChildByName("yidairuState");s.text=e.dataSource.roomPws,o.text=e.dataSource.dizhu,n.text=e.dataSource.participate+"/"+e.dataSource.number,0==e.dataSource.participate?n.color="#d59b2a":e.dataSource.participate>0&&e.dataSource.participate<e.dataSource.number?n.color="#66ce38":e.dataSource.participate==e.dataSource.number&&(n.color="#FF0000"),r.text=e.dataSource.roomTime+"分钟",l.visible=0==e.dataSource.participate&&!e.dataSource.gameStatus,d.visible=e.dataSource.participate>0&&!e.dataSource.gameStatus,c.visible=!!e.dataSource.gameStatus,g.visible=!!e.dataSource.dairu&&e.dataSource.dairu;let m=e.dataSource.time-a.getTimeChuo()<0?0:e.dataSource.time-a.getTimeChuo();h.text=a.secondToDate(m)}rowOnClick(e,t){if("click"==e.type){let t={roomPws:e.target.dataSource.roomPws,page:a.pages.page3};a.showLoading(!0,a.loadingType.three,"正在进入房间..."),a.$openScene("cheXuanGame_8.scene",!0,t,()=>{a.showLoading(!1,a.loadingType.three,"")})}}requestPageData(e){if(a.allowRequesList){e&&a.showLoading(!0);let t={uid:a.userInfo.userId};c.$request({that:this,url:"/M.Games.CX/GetRoomList",data:t,success(t){a.$LOG("获取大厅列表数据：",t),e&&a.showLoading(!1),0==t.data.ret.type?(this.callFn?(this.callFn("刷新成功"),this.callFn=null,setTimeout(()=>{this.dealWithResData(t.data.rooms)},500)):this.dealWithResData(t.data.rooms),this.openGameView()):a.showDialog(t.data.ret.msg,1)},fail(){e&&a.showLoading(!1),a.showDialog("网络异常!",1),this.callFn&&(this.callFn("刷新失败"),this.callFn=null)}})}else Laya.timer.clear(this,this.requestPageData,[!1])}openGameView(){let e=this.UI.pageData;if(e.roomPws&&e.roomPws>0){a.showLoading(!0,a.loadingType.three,"正在进入房间...");let t={roomPws:e.roomPws,page:a.pages.page3};a.$openScene("cheXuanGame_8.scene",!0,t,()=>{a.showLoading(!1,a.loadingType.three,"")})}}dealWithResData(e){let t=e,i=t.filter(e=>e.dairu),a=t.filter(e=>!e.dairu),s=i.sort(this.compare("dizhu")),o=a.sort(this.compare("dizhu")),n=s.filter(e=>e.participate>0&&e.participate<e.number),r=s.filter(e=>e.participate==e.number),h=s.filter(e=>0==e.participate),l=n.concat(r).concat(h),d=o.filter(e=>e.participate>0&&e.participate<e.number),c=o.filter(e=>e.participate==e.number),g=o.filter(e=>0==e.participate),m=d.concat(c).concat(g);t=l.concat(m),this._selectNavType==this._navType.all?(t=t,this.setPage1Data(t)):this._selectNavType==this._navType.small?(t=t.filter(e=>e.dizhu>=1&&e.dizhu<=5),this.setPage1Data(t)):this._selectNavType==this._navType.center?(t=t.filter(e=>e.dizhu>=10&&e.dizhu<=20),this.setPage1Data(t)):this._selectNavType==this._navType.big&&(t=t.filter(e=>e.dizhu>=50&&e.dizhu<=100),this.setPage1Data(t))}compare(e,t=!0){return function(i,a){var s=i[e],o=a[e];return 1==t?s-o:o-s}}}class ae extends Laya.Script{constructor(){super()}onEnable(){a.$LOG("Data牌局数据脚本：",this),ae.instance=this}openThisPage(){this.owner.visible&&(this.UI=this.owner.scene,this.requestPageData())}setPageListData(e){let t=this.UI.paiju_data_list;t.visible=!0,t.vScrollBarSkin="",t.array=e,t.renderHandler=new Laya.Handler(this,this.pageListOnRender)}pageListOnRender(e,t){let i=e.getChildByName("timeIcon"),a=e.getChildByName("timeBox"),s=a.getChildByName("month"),o=a.getChildByName("day");i.visible=e.dataSource.showTime,a.visible=e.dataSource.showTime,s.text=e.dataSource.month,o.text=e.dataSource.day;let n=e.getChildByName("list_bg"),r=n.getChildByName("top_title").getChildByName("name"),h=n.getChildByName("top_title").getChildByName("time"),l=n.getChildByName("roomID").getChildByName("value"),d=n.getChildByName("pi").getChildByName("value"),c=n.getChildByName("dairu").getChildByName("value"),g=n.getChildByName("winScore").getChildByName("value");r.text=e.dataSource.roomName,h.text=e.dataSource.roomTime,l.text=e.dataSource.roomPws,d.text=e.dataSource.pi,c.text=e.dataSource.dairu,g.text=e.dataSource.sf,-1!=g.text.indexOf("+")?g.color="#FF0000":-1!=g.text.indexOf("-")?g.color="#8FD900":g.color="#98999D"}requestPageData(){a.showLoading(!0);let e={uid:a.userInfo.userId};c.$request({that:this,url:"/M.Games.CX/GetPlayerRoomData",data:e,success(e){a.showLoading(!1),0==e.data.ret.type?this.dealWithResData(e.data):a.showDialog(e.data.ret.msg,1)},fail(){a.showLoading(!1),a.showDialog("网络异常!",1)}})}dealWithResData(e){let t=e.rooms;t.forEach((e,i)=>{let s=a.getFormatTime(1e3*e.time);e.month=s.month+"月",e.day=s.day+"日",e.roomTime=s.hour+":"+s.minutes,e.timeStr=s.timeStr,e.showTime=!0,i>0&&s.timeStr==t[i-1].timeStr&&(e.showTime=!1)}),this.setPageBaseData(e),this.setPageListData(t)}setPageBaseData(e){let t=e.totalSs,i=0==t?1:t;this.UI.data_winRate.text=parseInt(e.winSs/i*100)+"%",this.UI.data_fanpaiRate.text=parseInt(e.fpSs/i*100)+"%",this.UI.data_fanpaiwinRate.text=parseInt(e.fpWinSs/i*100)+"%",this.UI.data_changshu.text=e.totalJs,this.UI.data_shoushu.text=e.totalSs,this.UI.data_winNum.text=e.winSs,this.UI.data_pingju.text=e.tieSs,this.UI.data_fail.text=e.totalSs-e.winSs-e.tieSs}}class se extends Laya.Scene{constructor(){super()}onOpened(e){a.$LOG("tab页面所收到的值：",e),this.pageData=e,this.allowSetInterval=!0;let t=e.page?e.page:a.pages.page3;this.openView(t),this.setUI()}onAwake(){a.$LOG("TabPagesUI:",this),this.registerEvent()}registerEvent(){this.tab_notice.on(Laya.Event.CLICK,this,this.openView,[a.pages.page1]),this.tab_paiju.on(Laya.Event.CLICK,this,this.openView,[a.pages.page2]),this.tab_hall.on(Laya.Event.CLICK,this,this.openView,[a.pages.page3,1]),this.tab_data.on(Laya.Event.CLICK,this,this.openView,[a.pages.page4]),this.tab_me.on(Laya.Event.CLICK,this,this.openView,[a.pages.page5])}closeAllpages(){this.pages._children.forEach(e=>{e.visible=!1})}openView(e,t){a.allowRequesList=!1,this.closeAllpages(),this[e].visible=!0,this.reloadNavSelect(),this.setTabSelect(e),e===a.pages.page5?Q.instance.openThisPage():e===a.pages.page1?ee.instance.openThisPage():e===a.pages.page3?(a.allowRequesList=!0,a.allowHideLoad=1==t,ie.instance.openThisPage()):e===a.pages.page4&&ae.instance.openThisPage()}reloadNavSelect(){this.notice.visible=!0,this.notice_selected.visible=!1,this.paiju.visible=!0,this.paiju_selected.visible=!1,this.data.visible=!0,this.data_selected.visible=!1,this.me.visible=!0,this.me_selected.visible=!1}setTabSelect(e){switch(e){case a.pages.page1:this.notice.visible=!1,this.notice_selected.visible=!0;break;case a.pages.page2:this.paiju.visible=!1,this.paiju_selected.visible=!0;break;case a.pages.page4:this.data.visible=!1,this.data_selected.visible=!0;break;case a.pages.page5:this.me.visible=!1,this.me_selected.visible=!0}}setUI(){let e=[this.notice_content,this.hall_content,this.data_content,this.me_content];a.setNodeTop(e)}}class oe{static init(){let t=Laya.ClassUtils.regClass;t("game/common/setSceneWH.js",e),t("game/common/back.js",s),t("game/common/setHd.js",o),t("game/GameCenter/GameUI.js",I),t("game/GameCenter/seat.js",N),t("game/Fuction/MySlider.js",u),t("game/common/SetHeight.js",T),t("game/Fuction/MyClickSelect.js",b),t("game/GameCenter/GameControl.js",C),t("game/common/demo.js",E),t("game/pages/Set/Set.js",M),t("game/common/MySwitch.js",P),t("game/pages/login/LoginUI.js",O),t("game/common/openView.js",D),t("game/pages/login/Login.js",A),t("game/pages/roomEnd/roomEndUI.js",R),t("game/pages/roomEnd/roomEnd.js",V),t("game/pages/paijuhuigu/paijuhuiguUI.js",U),t("game/pages/paijuhuigu/paiJuGet.js",X),t("game/pages/paijutishi/paijutishiUI.js",H),t("game/pages/paijutishi/tishi.js",G),t("game/pages/playerNewsSet/playerNewsSetUI.js",j),t("game/pages/playerNewsSet/playerNewsSet.js",F),t("game/pages/register/registerUI.js",Y),t("game/pages/register/register.js",$),t("game/pages/service/service.js",Z),t("game/pages/shishizhanji/shishizhanjiUI.js",K),t("game/pages/shishizhanji/ZhanJiGet.js",z),t("game/pages/shopMall/shopMallUI.js",W),t("game/pages/shopMall/shopMall.js",q),t("game/pages/TabPages/TabPagesUI.js",se),t("game/pages/Me/Me.js",Q),t("game/pages/Notice/Notice.js",ee),t("game/pages/GameHall/GameHall.js",ie),t("game/common/dropDownReload.js",te),t("game/pages/Data/Data.js",ae)}}oe.width=1242,oe.height=2208,oe.scaleMode="fixedwidth",oe.screenMode="none",oe.alignV="top",oe.alignH="left",oe.startScene="demo.scene",oe.sceneRoot="",oe.debug=!1,oe.stat=!1,oe.physicsDebug=!1,oe.exportSceneToJson=!0,oe.init();new class{constructor(){window.Laya3D?Laya3D.init(oe.width,oe.height):Laya.init(oe.width,oe.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=oe.scaleMode,Laya.stage.screenMode=oe.screenMode,Laya.stage.alignV=oe.alignV,Laya.stage.alignH=oe.alignH,Laya.URL.exportSceneToJson=oe.exportSceneToJson,(oe.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),oe.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),oe.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){oe.startScene&&Laya.Scene.open(oe.startScene)}}}();